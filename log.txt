è®®é¢˜è¯´æ˜ 
è®®é¢˜ä¸€ å¼€å‘ä¸€ä¸ªæ ¹æ®ä¸€ç¯‡å°è¯´ç”Ÿæˆç›¸åº”æ¼«ç”»çš„åº”ç”¨ã€‚ 
è¯·å›ç­”: 
1.ä½ è®¡åˆ’å°†è¿™ä¸ªäº§å“é¢å‘ä»€ä¹ˆç±»å‹çš„ç”¨æˆ·?è¿™äº›ç±»å‹çš„ç”¨æˆ·ä»–ä»¬é¢ä¸´ä»€ä¹ˆæ ·çš„ç—›ç‚¹ï¼Œä½ è®¾æƒ³çš„ç”¨æˆ·æ•…äº‹æ˜¯ä»€ä¹ˆæ ·å‘¢? 
2.ä½ è®¤ä¸ºè¿™ä¸ªäº§å“å®ç°ä¸Šçš„æŒ‘æˆ˜æ˜¯ä»€ä¹ˆï¼Œä½ è®¡åˆ’å¦‚ä½•åº”å¯¹è¿™äº›æŒ‘æˆ˜? 
3.ä½ è®¡åˆ’é‡‡çº³å“ªå®¶å…¬å¸çš„å“ªä¸ªæ¨¡å‹çš„AIGCåŠŸèƒ½?ä½ å¯¹æ¯”äº†å“ªäº›ï¼Œä½ ä¸ºä»€ä¹ˆé€‰æ‹©ç”¨è¯¥API? 
4.ä½ å¯¹è¿™ä¸ªäº§å“æœ‰å“ªäº›æœªæ¥è§„åˆ’ä¸­çš„åŠŸèƒ½?ä½ ä¸ºä½•è§‰å¾—è¿™äº›èƒ½åŠ›æ˜¯é‡è¦çš„? 
è¯·å¼€å‘ä»¥ä¸Šåº”ç”¨ã€‚è¦æ±‚ä¸èƒ½è°ƒç”¨ç¬¬ä¸‰æ–¹çš„agentèƒ½åŠ›ï¼Œåªéœ€å…è®¸è°ƒç”¨LLMã€å„ç±»AIGCæ¨¡å‹å’Œè¯­éŸ³TTSèƒ½åŠ›ã€‚
åŒæ—¶é’ˆå¯¹ä»¥ä¸Š1-4ç‚¹ï¼Œè¯·æŠŠä½ çš„æ€è€ƒæ•´ç†æˆæ–‡æ¡£ï¼Œä½œä¸ºä½œå“çš„è¯´æ˜ä¸€å¹¶æäº¤ã€‚


@log.txt æ ¹æ®æ•´ä½“é¡¹ç›®æƒ…å†µä¸log.txtï¼Œ
æ–°å»ºä¸€ä¸ªreadmeæ–‡æ¡£ï¼Œæ–°æ–‡æ¡£è¿˜æ˜¯æŠŠè®®é¢˜è¯´æ˜å†™åœ¨æœ€å‰é¢ï¼ˆ1-9è¡Œï¼‰ï¼Œ
ç„¶åæ€»ç»“ä¸€ä¸‹ç°åœ¨æƒ…å†µï¼Œ
ä»ä¾èµ–é…ç½®åˆ°gitignoreåˆ°è™šæ‹Ÿç¯å¢ƒçš„åˆ›å»ºã€æ•°æ®åº“çš„è¿æ¥ã€è¿˜æœ‰ç°åœ¨çš„åç«¯ä¸å‰ç«¯éƒ½å¹²äº†å“ªäº›ä¸œè¥¿



pythonç‰ˆæœ¬

ä½ ä¸éœ€è¦â€œé™çº§â€ä½ ç”µè„‘çš„ Pythonã€‚ä½ åªéœ€è¦\*\*â€œå¹¶å­˜â€**ï¼Œç„¶å**å‘Šè¯‰è™šæ‹Ÿç¯å¢ƒï¼ˆvenvï¼‰å®ƒè¯¥ç”¨å“ªä¸ª\*\*ã€‚

ä½ ç°åœ¨ç”µè„‘ä¸Šè£…äº† Python 3.13ã€‚ä½ éœ€è¦åšçš„ï¼Œåªæ˜¯**å†å®‰è£…ä¸€ä¸ª Python 3.11**ï¼Œç„¶åç”¨ 3.11 æ¥**åˆ›å»º**è¿™ä¸ªé¡¹ç›®çš„è™šæ‹Ÿç¯å¢ƒã€‚ä½ å…¶ä»–çš„é¡¹ç›®**å®Œå…¨ä¸å—å½±å“**ã€‚

#### æ­¥éª¤ä¸€ï¼šå®‰è£… Python 3.11 (ä¸ 3.13 å¹¶å­˜)

1.  å» Python å®˜æ–¹ç½‘ç«™ (python.org)ã€‚
2.  ä¸‹è½½ **Python 3.11** çš„ Windows 64ä½å®‰è£…åŒ… (Windows installer)ã€‚
3.  è¿è¡Œå®‰è£…åŒ…ã€‚**åœ¨å®‰è£…ç•Œé¢ä¸Šï¼Œè¯·æ³¨æ„ï¼š**
      * **ä¸è¦** å‹¾é€‰ "Make this the default Python" æˆ– "Add to PATH" ï¼ˆå¦‚æœä½ æ‹…å¿ƒå½±å“å…¶ä»–é¡¹ç›®ï¼Œå°±éƒ½åˆ«å‹¾é€‰ï¼‰ã€‚
      * **å¿…é¡»** ç¡®ä¿ "Install for all users" å’Œ "Install `py.exe` launcher" æ˜¯å‹¾é€‰çš„ï¼ˆé€šå¸¸é»˜è®¤å°±æ˜¯ï¼‰ã€‚
4.  å®Œæˆå®‰è£…ã€‚ç°åœ¨ä½ çš„ç”µè„‘ä¸ŠåŒæ—¶æ‹¥æœ‰ Python 3.13 å’Œ 3.11ã€‚`py.exe` å¯åŠ¨å™¨çŸ¥é“å®ƒä»¬åˆ†åˆ«åœ¨å“ªé‡Œã€‚

#### æ­¥éª¤äºŒï¼šä½¿ç”¨ 3.11 åˆ›å»ºæ–°çš„è™šæ‹Ÿç¯å¢ƒ

è¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ã€‚

1.  æ‰“å¼€ä½ çš„å‘½ä»¤è¡Œï¼Œè¿›å…¥ `backend` ç›®å½•ã€‚

2.  **åˆ é™¤æ—§çš„ã€åçš„ venvï¼š**

    ```bash
    rmdir /s /q venv 
    ```

    *(å¦‚æœæç¤ºæ— æƒé™ï¼Œç›´æ¥ç”¨æ–‡ä»¶ç®¡ç†å™¨å³é”®åˆ é™¤ `venv` æ–‡ä»¶å¤¹)*

3.  **ã€é­”æ³•åœ¨è¿™é‡Œã€‘** ä½¿ç”¨ `py.exe` å¯åŠ¨å™¨ï¼Œ**æŒ‡å®šç”¨ 3.11 ç‰ˆæœ¬**æ¥åˆ›å»º venvï¼š

    ```bash
    py -3.11 -m venv venv
    ```

      * `py -3.11` çš„æ„æ€å°±æ˜¯â€œå˜¿ï¼ŒWindowsï¼Œè¯·ä½¿ç”¨æˆ‘å®‰è£…çš„ 3.11 ç‰ˆæœ¬çš„ Python...â€ã€‚
      * `... -m venv venv` çš„æ„æ€å°±æ˜¯â€œ...æ¥åˆ›å»ºä¸€ä¸ªåä¸º venv çš„è™šæ‹Ÿç¯å¢ƒâ€ã€‚

4.  **æ¿€æ´»æ–°ç¯å¢ƒå¹¶å®‰è£…ä¾èµ–ï¼š**

    ```bash
    # æ¿€æ´»è¿™ä¸ªæ–°åˆ›å»ºçš„ã€åŸºäº 3.11 çš„ venv
    venv\Scripts\activate

    # ä½ çš„å‘½ä»¤è¡Œæç¤ºç¬¦ç°åœ¨ä¼šæ˜¾ç¤º (venv)
    # æ£€æŸ¥ä¸€ä¸‹ç‰ˆæœ¬ (å¯é€‰)
    (venv) ...> python -V 
    # (æ­¤æ—¶åº”è¯¥ä¼šæ˜¾ç¤º Python 3.11.x)

    # å†æ¬¡è¿è¡Œå®‰è£…
    (venv) ...> pip install -r requirements.txt 
    ```

**å¤§åŠŸå‘Šæˆã€‚**

è¿™ä¸€æ¬¡ï¼Œ`pip` ä¼šåœ¨ Python 3.11 çš„ç¯å¢ƒé‡Œè¿è¡Œï¼Œå®ƒä¼šæ‰¾åˆ° `asyncpg` å®˜æ–¹ä¸º Python 3.11 æä¾›çš„ã€**å·²ç»ç¼–è¯‘å¥½çš„** `.whl` æ–‡ä»¶ï¼Œç›´æ¥ä¸‹è½½å®‰è£…ï¼Œ**æ ¹æœ¬ä¸ä¼šåœ¨ä½ æœ¬åœ°è¿›è¡Œç¼–è¯‘**ï¼Œä¹Ÿå°±ä¸ä¼šå†æŠ¥é”™äº†ã€‚

ä½ çš„é¡¹ç›®ç°åœ¨è¿è¡Œåœ¨éš”ç¦»çš„ 3.11 venv ä¸­ï¼Œè€Œä½ å…¶ä»–æ‰€æœ‰çš„é¡¹ç›®å’Œä½ å…¨å±€çš„ Python 3.13 æ¯«å‘æ— æŸã€‚





py -3.11 -m venv venv
venv\Scripts\activate
python -V
# å¸è½½æœ‰é—®é¢˜çš„bcryptç‰ˆæœ¬
pip uninstall bcrypt
# é‡æ–°å®‰è£…æ‰€æœ‰ä¾èµ–
pip install -r requirements.txt
# å¯åŠ¨æœåŠ¡
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

python test_db.py
python test_auth.py










æœ‰ç™»å½•æ³¨å†Œï¼Œæœªç™»å½•çŠ¶æ€ä¸‹æ— æ³•ä½¿ç”¨åŠŸèƒ½ï¼Œåªèƒ½çœ‹åˆ«äººçš„ä½œå“
    æ•°æ®åº“ï¼šç”¨æˆ·ä¿¡æ¯è¡¨ï¼ˆè´¦å·å¯†ç å¯ä½¿ç”¨é¢åº¦ç­‰ï¼‰

æ–‡æœ¬è§£æå±‚ï¼ˆLLMï¼‰ï¼šæŠŠåŸæ–‡æ‹†æˆåœºæ™¯ã€äººç‰©ã€åŠ¨ä½œã€æƒ…ç»ªã€å…³é”®é“å…·ä¸å¯¹è¯ï¼›è¾“å‡ºç»“æ„åŒ–è„šæœ¬ï¼ˆJSONï¼‰ã€‚
    æ•°æ®åº“ï¼šç”¨æˆ·ä¸Šä¼ çš„å°è¯´æ–‡å­—æˆ–è€…æ–‡ä»¶åº”è¿›è¡Œå­˜å‚¨ï¼Œå…·ä½“å¦‚ä½•å­˜å‚¨è¿™äº›å¤§é‡çš„æ–‡å­—è¿˜ä¸ç¡®å®š

åˆ†é•œè§„åˆ’å±‚ï¼ˆLLM æˆ–è§„åˆ™é€»è¾‘ï¼‰ï¼šæ ¹æ®åœºæ™¯èŠ‚å¥å†³å®šæ¯é¡µé¢æ¿æ•°ã€é•œå¤´ç±»å‹ã€æ„å›¾è¦ç‚¹ï¼ˆè¿‘æ™¯/è¿œæ™¯/é¸Ÿç°ï¼‰å¹¶ç”Ÿæˆæ¯ä¸ª panel çš„æè¿°ã€‚
    æ•°æ®åº“ï¼šæ–‡æœ¬è§£æä¹‹åçš„è¯¦ç»†åˆ†é•œä¿¡æ¯åº”è¿›è¡Œå­˜å‚¨ï¼Œå­˜å‚¨è¿™äº›æ–‡å­—ä¹Ÿä¸ç¡®å®šæ€ä¹ˆå­˜





æ–‡æœ¬åˆ°åˆ†é•œï¼ˆstory-to-panelï¼‰éœ€è¦ç†è§£å‰§æƒ…èŠ‚ç‚¹ã€é•œå¤´æ„å›¾ã€èŠ‚å¥ã€‚

å›¾åƒä¸€è‡´æ€§ï¼ˆäººç‰©åœ¨ä¸åŒç”»é¢ä¿æŒç›¸è²Œã€æœè£…ï¼‰ã€‚

å¯¹è¯æ°”æ³¡ä¸æ–‡å­—æ’ç‰ˆçš„å¯è¯»æ€§ã€‚

ç”Ÿæˆæ¼«ç”»é£æ ¼çš„é«˜è´¨é‡å›¾åƒï¼ˆæ¼«ç”»çº¿æ¡ã€ä¸Šè‰²ã€é˜´å½±ï¼‰ã€‚

é•¿æ–‡æœ¬çš„ä¸Šä¸‹æ–‡ä¿æŒä¸åˆ†åœºæ™¯åˆ‡åˆ†ã€‚

æ€§èƒ½ä¸æˆæœ¬ï¼ˆå¤§æ¨¡å‹è°ƒç”¨ã€GPUï¼‰ã€‚

åº”å¯¹ç­–ç•¥

åˆ†å±‚ç®¡çº¿ï¼ˆpipelineï¼‰è®¾è®¡ï¼š

æ–‡æœ¬è§£æå±‚ï¼ˆLLMï¼‰ï¼šæŠŠåŸæ–‡æ‹†æˆåœºæ™¯ã€äººç‰©ã€åŠ¨ä½œã€æƒ…ç»ªã€å…³é”®é“å…·ä¸å¯¹è¯ï¼›è¾“å‡ºç»“æ„åŒ–è„šæœ¬ï¼ˆJSONï¼‰ã€‚

åˆ†é•œè§„åˆ’å±‚ï¼ˆLLM æˆ–è§„åˆ™é€»è¾‘ï¼‰ï¼šæ ¹æ®åœºæ™¯èŠ‚å¥å†³å®šæ¯é¡µé¢æ¿æ•°ã€é•œå¤´ç±»å‹ã€æ„å›¾è¦ç‚¹ï¼ˆè¿‘æ™¯/è¿œæ™¯/é¸Ÿç°ï¼‰å¹¶ç”Ÿæˆæ¯ä¸ª panel çš„æè¿°ã€‚

å›¾åƒç”Ÿæˆå±‚ï¼ˆAIGCï¼‰ï¼šå¯¹æ¯ä¸ª panel çš„æè¿°è°ƒç”¨æ–‡æœ¬åˆ°å›¾åƒæ¨¡å‹ï¼ˆå¯é…åˆ ControlNet/pose/segmentation å¼•å¯¼ï¼‰ç”Ÿæˆè‰ç¨¿ï¼Œä½¿ç”¨äººç‰©ä¸€è‡´æ€§æœºåˆ¶ï¼ˆå‚è€ƒï¼šäººç‰© embeddingã€å‚è€ƒå›¾åƒæˆ– LoRA/ä¸“å± embeddingï¼‰ä»¥ç»´æŒä¸€è‡´æ€§ã€‚

åå¤„ç†å±‚ï¼šæ°”æ³¡æ’ç‰ˆï¼ˆæ–‡æœ¬æ¸²æŸ“ï¼‰ã€å›¾åƒåˆæˆã€è‰²å½©è°ƒæ•´ã€å»å™ªä¸é£æ ¼ä¸€è‡´åŒ–ï¼ˆå¯ç”¨å›¾åƒåˆ°å›¾åƒå¾®è°ƒ/å¾ªç¯ä¿®æ­£ï¼‰ã€‚

ä¿æŒäººç‰©ä¸€è‡´æ€§çš„æŠ€å·§ï¼š

å…è®¸ç”¨æˆ·ä¸Šä¼  2â€“4 å¼ è§’è‰²å‚è€ƒå›¾ï¼ˆæˆ–è§’è‰²æè¿°å¡ï¼‰ï¼Œå¹¶ä½¿ç”¨ä¸“å± embedding / LoRA / DreamBoothï¼ˆæˆ–è‡ªæ‰˜ç®¡ç­‰ä»·ï¼‰ä»¥ä¿æŒé£æ ¼ä¸€è‡´ã€‚

åœ¨ç”Ÿæˆä¸­ä½¿ç”¨å…ˆç”Ÿæˆè‰å›¾ï¼Œç„¶åå¯¹è‰å›¾åšé£æ ¼è¿ç§»çš„ä¸¤é˜¶æ®µæµç¨‹ã€‚

é•¿æ–‡æœ¬å¤„ç†ï¼šåˆ†æ®µæ‘˜è¦ + åœºæ™¯åˆ’åˆ†ï¼Œå…ˆç”¨ LLM åšâ€œå‰§æƒ…å‹ç¼©â€ï¼Œå†é€æ®µç”Ÿæˆåˆ†é•œã€‚

æˆæœ¬æ§åˆ¶ï¼š

æŠŠå®æ—¶äº¤äº’ï¼ˆæµè§ˆå™¨é¢„è§ˆã€å°å›¾ï¼‰ç”¨å°æ¨¡å‹æˆ–ä½åˆ†è¾¨ç‡ç”Ÿæˆï¼›æŠŠé«˜è´¨é‡æ¸²æŸ“æ”¾åˆ°å¼‚æ­¥é˜Ÿåˆ—ï¼ŒæŒ‰éœ€ä»˜è´¹æˆ–è®©ç”¨æˆ·è´­ä¹°æ¸²æŸ“é¢åº¦ã€‚

ç¼“å­˜ä¸å»é‡ï¼ˆç›¸åŒ prompt ä¸ç›¸åŒç§å­ä¸é‡å¤ç”Ÿæˆï¼‰ã€‚

å¯æ§æ€§ä¸ç¼–è¾‘æ€§ï¼šæä¾› UI è®©ç”¨æˆ·ä¿®æ”¹åˆ†é•œï¼ˆç§»åŠ¨/åˆå¹¶/åˆ†å‰² panelï¼‰ã€æ›¿æ¢å•å¹…å›¾åƒå¹¶é‡æ–°æ‰¹é‡æ¸²æŸ“ã€‚




é¡¹ç›®æ„ŸçŸ¥
ä¸€ä¸ªé¡¹ç›®ï¼ˆProjectï¼‰çš„è§’è‰²åŸºç¡€è®¾å®šï¼ˆcharacters.descriptionï¼‰åº”è¯¥æ˜¯æŒä¹…åŒ–ä¸”å”¯ä¸€çš„ã€‚åœ¨å¤„ç†åç»­ç« èŠ‚ï¼ˆsource_textsï¼‰æ—¶ï¼ŒAI ä¸åº”è¯¥ï¼ˆä¹Ÿä¸éœ€è¦ï¼‰é‡æ–°ç”Ÿæˆå·²å­˜åœ¨è§’è‰²çš„descriptionï¼Œè€Œåªåº”è¯¥ç”Ÿæˆè¯¥åˆ†é•œç‰¹æœ‰çš„character_appearanceï¼ˆæƒ…æ™¯å¤–è²Œï¼‰ã€‚

ä½ ç›®å‰çš„ generate_storyboard_for_segment å‡½æ•°ï¼ˆå¦‚ä½ æ‰€ç¤ºï¼‰æ¯æ¬¡éƒ½ä¼šè®© AI åŒæ—¶ç”Ÿæˆ characters å’Œ storyboardsï¼Œè¿™ä¼šå¯¼è‡´è§’è‰²æ•°æ®çš„å†—ä½™å’Œè¦†ç›–ã€‚

æ›´å¥½çš„è§£å†³æ–¹å¼ï¼šâ€œé¡¹ç›®æ„ŸçŸ¥â€çš„æ•°æ®æµ
æˆ‘ä»¬ä¸éœ€è¦åœ¨åˆ†é•œè§„åˆ’å‰â€œå…ˆç¡®å®šè§’è‰²â€ï¼ˆè¿™ä¼šå¢åŠ ç”¨æˆ·è´Ÿæ‹…ï¼‰ï¼Œè€Œæ˜¯è®©AIå¤„ç†æµç¨‹å˜å¾—â€œé¡¹ç›®æ„ŸçŸ¥â€ã€‚

å½“ç”¨æˆ·ä¸Šä¼ ä¸€ä¸ªæ–°ç« èŠ‚ï¼ˆsource_textsï¼‰æ—¶ï¼Œæˆ‘ä»¬çš„åç«¯ API åº”è¯¥ï¼š

æŸ¥è¯¢ï¼šä» characters è¡¨ä¸­ï¼Œè·å–è¯¥ project_id ä¸‹æ‰€æœ‰å·²å­˜åœ¨çš„è§’è‰²ã€‚

æ³¨å…¥ï¼šå°†è¿™äº›â€œå·²å­˜åœ¨è§’è‰²â€çš„åˆ—è¡¨ï¼ˆåç§°å’Œæè¿°ï¼‰æ³¨å…¥åˆ° AI çš„æç¤ºè¯ (Prompt) ä¸­ã€‚

æŒ‡ç¤ºï¼š

å‘Šè¯‰ AIï¼šâ€œè¿™äº›æ˜¯æœ¬é¡¹ç›®å·²çŸ¥çš„è§’è‰²ã€‚åœ¨ç”Ÿæˆåˆ†é•œæ—¶ï¼Œå¦‚æœæ–‡æœ¬æåˆ°äº†ä»–ä»¬ï¼Œè¯·ç›´æ¥ä½¿ç”¨ä»–ä»¬çš„åå­—ã€‚â€

å‘Šè¯‰ AIï¼šâ€œå¦‚æœæ–‡æœ¬ä¸­å‡ºç°äº†æ–°è§’è‰²ï¼ˆä¸åœ¨æˆ‘ç»™ä½ çš„åˆ—è¡¨é‡Œï¼‰ï¼Œè¯·åœ¨ characters æ•°ç»„ä¸­ä¸ºä»–ä»¬ç”Ÿæˆæ–°çš„æè¿°ã€‚â€

å‘Šè¯‰ AIï¼šâ€œå¯¹äº storyboards æ•°ç»„ï¼Œè¯·å§‹ç»ˆç”Ÿæˆ character_appearanceï¼ˆæƒ…æ™¯å¤–è²Œï¼‰ã€‚â€

è¿™æ ·å°±å®Œç¾è§£å†³äº†é—®é¢˜ï¼š

é¦–æ¬¡ä¸Šä¼ ï¼ˆç¬¬ä¸€ç« ï¼‰ï¼šexisting_characters åˆ—è¡¨ä¸ºç©ºã€‚AI ä¼šè§£æå¹¶è¿”å›æ‰€æœ‰æ–°è§’è‰²çš„ descriptionã€‚

åç»­ä¸Šä¼ ï¼ˆç¬¬äºŒç« ï¼‰ï¼šexisting_characters åˆ—è¡¨åŒ…å«â€œææ…•ç™½â€å’Œâ€œç‹ç‚â€ã€‚AI åœ¨å¤„ç†ç¬¬äºŒç« æ—¶ï¼Œä¸ä¼šåœ¨ characters æ•°ç»„é‡Œå†æ¬¡è¿”å›ä»–ä»¬ï¼Œé™¤éç¬¬äºŒç« å‡ºç°äº†æ–°è§’è‰²â€œèµµé•¿è€â€ã€‚AI åªä¼šä¸“æ³¨äºç”Ÿæˆ storyboardsã€‚






/*
 Navicat Premium Dump SQL

 Source Server         : n-c
 Source Server Type    : PostgreSQL
 Source Server Version : 170006 (170006)
 Source Host           : aws-1-ap-south-1.pooler.supabase.com:5432
 Source Catalog        : postgres
 Source Schema         : public

 Target Server Type    : PostgreSQL
 Target Server Version : 170006 (170006)
 File Encoding         : 65001

 Date: 24/10/2025 10:39:27
*/


-- ----------------------------
-- Table structure for characters
-- ----------------------------
DROP TABLE IF EXISTS "public"."characters";
CREATE TABLE "public"."characters" (
  "character_id" uuid NOT NULL DEFAULT gen_random_uuid(),
  "project_id" uuid NOT NULL,
  "name" varchar(255) COLLATE "pg_catalog"."default" NOT NULL,
  "description" text COLLATE "pg_catalog"."default",
  "reference_image_urls" json,
  "lora_model_path" varchar(1024) COLLATE "pg_catalog"."default",
  "trigger_word" varchar(100) COLLATE "pg_catalog"."default"
)
;
COMMENT ON COLUMN "public"."characters"."character_id" IS 'å”¯ä¸€è§’è‰²ID (UUID)';
COMMENT ON COLUMN "public"."characters"."project_id" IS 'å¤–é”®ï¼Œå…³è”åˆ° projects(project_id)';
COMMENT ON COLUMN "public"."characters"."name" IS 'è§’è‰²åç§° (ä¾‹å¦‚ "å¼ ä¸‰")';
COMMENT ON COLUMN "public"."characters"."description" IS 'ã€è§’è‰²å¤–è²Œã€æ€§æ ¼æè¿°ã€‘çš„è¯¦ç»†æè¿° (ä¾‹å¦‚ï¼šå¹´é¾„, æ€§åˆ«, èº«é«˜, ä½“å‹, å‘å‹, å‘è‰², çœ¼ç›, ç©¿ç€, ç‰¹æ®Šé…é¥°)(ä¾›å¤§è¯­è¨€æ¨¡å‹ä½¿ç”¨)';
COMMENT ON COLUMN "public"."characters"."reference_image_urls" IS 'è§’è‰²å‚è€ƒå›¾URLåˆ—è¡¨ (JSONæ•°ç»„æ ¼å¼, å­˜å‚¨S3/OSSçš„å¯¹è±¡å­˜å‚¨URL)';
COMMENT ON COLUMN "public"."characters"."lora_model_path" IS 'æŒ‡å‘ S3/OSS ä¸Šçš„LoRAæ¨¡å‹æˆ–Embeddingæ–‡ä»¶è·¯å¾„ (ä¾‹å¦‚ /models/lora/xxx.safetensors)';
COMMENT ON COLUMN "public"."characters"."trigger_word" IS 'è§¦å‘è¯¥LoRAçš„å…³é”®è¯ (ä¾‹å¦‚ "ohwx_zhangsan")';
COMMENT ON TABLE "public"."characters" IS 'é¡¹ç›®è§’è‰²è¡¨';

-- ----------------------------
-- Records of characters
-- ----------------------------
INSERT INTO "public"."characters" VALUES ('c0a1b2c3-1111-4f5e-8d9c-0a2a3a4a5b01', 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'ææ…•ç™½', 'å¹´é¾„17å², ç”·æ€§, èº«é«˜178cm, èº«æä¿®é•¿, é»‘è‰²é•¿å‘æŸæˆé©¬å°¾, é»‘è‰²çœ¼çœ¸çŠ€åˆ©, ç©¿ç€æœ´ç´ çš„è“è‰²æ­¦é“è¢, èƒŒç€ä¸€ä¸ªç«¹åˆ¶èƒŒåŒ…å’Œä¸€æŠŠå‰‘', '["https://cdn.example.com/ref/limubai_ref1.png"]', '/models/lora/project_a_limubai.safetensors', 'ohwx_limubai');
INSERT INTO "public"."characters" VALUES ('c0a1b2c3-2222-4f5e-8d9c-0a2a3a4a5b02', 'f47ac10b-58cc-4372-a567-0e02b2c3d480', 'ç‹ç‚', 'å¹´é¾„22å², å¥³æ€§, èº«é«˜165cm, ä¸­ç­‰èº«æ, å‡Œä¹±çš„é»‘è‰²çŸ­å‘, æƒŠæçš„å¤§çœ¼ç›, ç©¿ç€å®½å¤§çš„Tæ¤å’ŒçŸ­è£¤, æ²¡æœ‰é…é¥°', '["https://cdn.example.com/ref/wangke_ref1.png"]', '/models/lora/project_b_wangke.safetensors', 'ohwx_wangke');

-- ----------------------------
-- Table structure for projects
-- ----------------------------
DROP TABLE IF EXISTS "public"."projects";
CREATE TABLE "public"."projects" (
  "project_id" uuid NOT NULL DEFAULT gen_random_uuid(),
  "user_id" uuid NOT NULL,
  "title" varchar(255) COLLATE "pg_catalog"."default" NOT NULL,
  "description" text COLLATE "pg_catalog"."default",
  "visibility" "public"."project_visibility" DEFAULT 'private'::project_visibility,
  "default_style_prompt" text COLLATE "pg_catalog"."default",
  "created_at" timestamptz(6) DEFAULT timezone('utc'::text, now()),
  "updated_at" timestamptz(6) DEFAULT timezone('utc'::text, now())
)
;
COMMENT ON COLUMN "public"."projects"."project_id" IS 'å”¯ä¸€é¡¹ç›®ID (UUID)';
COMMENT ON COLUMN "public"."projects"."user_id" IS 'å¤–é”®ï¼Œå…³è”åˆ° users(user_id)ï¼Œè¡¨ç¤ºè¯¥é¡¹ç›®çš„æ‰€æœ‰è€…';
COMMENT ON COLUMN "public"."projects"."title" IS 'é¡¹ç›®æ ‡é¢˜ (ä¾‹å¦‚ "æˆ‘çš„XXå°è¯´æ”¹ç¼–")';
COMMENT ON COLUMN "public"."projects"."description" IS 'é¡¹ç›®æè¿°';
COMMENT ON COLUMN "public"."projects"."visibility" IS 'å¯è§æ€§ï¼šprivate(ä»…è‡ªå·±), public(ä»–äººå¯è§)';
COMMENT ON COLUMN "public"."projects"."default_style_prompt" IS 'é¡¹ç›®çš„é»˜è®¤é£æ ¼æç¤ºè¯ (ä¾‹å¦‚ "shonen manga, high contrast")';
COMMENT ON COLUMN "public"."projects"."created_at" IS 'é¡¹ç›®åˆ›å»ºæ—¶é—´';
COMMENT ON COLUMN "public"."projects"."updated_at" IS 'é¡¹ç›®æœ€åæ›´æ–°æ—¶é—´';
COMMENT ON TABLE "public"."projects" IS 'æ¼«ç”»é¡¹ç›®è¡¨';

-- ----------------------------
-- Records of projects
-- ----------------------------
INSERT INTO "public"."projects" VALUES ('f47ac10b-58cc-4372-a567-0e02b2c3d479', 'a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11', 'ä»™å°˜', 'ä¸€éƒ¨å…³äºå‡¡äººä¿®ä»™çš„å°è¯´æ”¹ç¼–é¡¹ç›®', 'private', 'manga, black-and-white screentone, clean lineart, chinese ink style', '2025-10-23 17:55:37.636342+00', '2025-10-23 17:55:37.636342+00');
INSERT INTO "public"."projects" VALUES ('f47ac10b-58cc-4372-a567-0e02b2c3d480', 'a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a22', 'éƒ½å¸‚å¤œå½’äºº', 'ç°ä»£éƒ½å¸‚èƒŒæ™¯ä¸‹çš„å¥‡å¹»æ•…äº‹', 'public', 'webtoon, full color, high clarity, dynamic actionpose', '2025-10-23 17:55:37.636342+00', '2025-10-23 17:55:37.636342+00');
INSERT INTO "public"."projects" VALUES ('b7c63fe9-7c25-4122-bf59-0e9fcf34d4a6', '19602e5a-7e68-4e91-8b67-ee27d2f29bd5', 'æµ‹è¯•é¡¹ç›®', 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•é¡¹ç›®', 'private', NULL, '2025-10-24 01:37:31.277426+00', '2025-10-24 01:37:31.277426+00');

-- ----------------------------
-- Table structure for source_texts
-- ----------------------------
DROP TABLE IF EXISTS "public"."source_texts";
CREATE TABLE "public"."source_texts" (
  "text_id" uuid NOT NULL DEFAULT gen_random_uuid(),
  "project_id" uuid NOT NULL,
  "title" varchar(255) COLLATE "pg_catalog"."default" DEFAULT 'Untitled Chapter'::character varying,
  "raw_content" text COLLATE "pg_catalog"."default" NOT NULL,
  "order_index" int4 DEFAULT 0,
  "created_at" timestamptz(6) DEFAULT timezone('utc'::text, now())
)
;
COMMENT ON COLUMN "public"."source_texts"."text_id" IS 'å”¯ä¸€æ–‡æœ¬ID (UUID)';
COMMENT ON COLUMN "public"."source_texts"."project_id" IS 'å¤–é”®ï¼Œå…³è”åˆ° projects(project_id)';
COMMENT ON COLUMN "public"."source_texts"."title" IS 'æ ‡é¢˜ (ä¾‹å¦‚ "ç¬¬ä¸€ç« " æˆ– "ç•ªå¤–ç¯‡")';
COMMENT ON COLUMN "public"."source_texts"."raw_content" IS 'å­˜å‚¨ç”¨æˆ·ä¸Šä¼ çš„åŸå§‹å°è¯´æ–‡æœ¬ (PostgreSQLçš„TEXTç±»å‹å·²è¶³å¤Ÿ)';
COMMENT ON COLUMN "public"."source_texts"."order_index" IS 'ç”¨äºç« èŠ‚æˆ–æ–‡æœ¬ç‰‡æ®µçš„æ’åº';
COMMENT ON COLUMN "public"."source_texts"."created_at" IS 'ä¸Šä¼ æ—¶é—´';
COMMENT ON TABLE "public"."source_texts" IS 'å°è¯´åŸæ–‡è¡¨';

-- ----------------------------
-- Records of source_texts
-- ----------------------------
INSERT INTO "public"."source_texts" VALUES ('d1b6e6e8-0b6f-4a81-8b43-6a107b7b1e2c', 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'ç¬¬ä¸€ç« ï¼šä¸‹å±±', 'æ¸…æ™¨ï¼Œé›¾æ°”å°šæœªæ•£å»ï¼Œå°‘å¹´ææ…•ç™½èƒŒç€è¡Œå›Šï¼Œæœ€åçœ‹äº†ä¸€çœ¼å±±é¡¶çš„èŒ…å±‹ï¼Œæ¯…ç„¶è½¬èº«ä¸‹å±±ã€‚ä»–ä¸çŸ¥é“ï¼Œæ­¤è¡Œå°†æ”¹å˜ä»–çš„ä¸€ç”Ÿã€‚', 0, '2025-10-23 17:55:37.857842+00');
INSERT INTO "public"."source_texts" VALUES ('d1b6e6e8-0b6f-4a81-8b43-6a107b7b1e2d', 'f47ac10b-58cc-4372-a567-0e02b2c3d480', 'åºç« ï¼šé›¨å¤œ', 'å†°å†·çš„é›¨æ°´æ‹æ‰“åœ¨é™ˆæ—§çš„çª—æˆ·ä¸Šã€‚ç‹ç‚ç¼©åœ¨è§’è½ï¼Œå€Ÿç€é—ªç”µçš„å…‰èŠ’ï¼Œå¥¹çœ‹åˆ°é‚£ä¸ªé»‘å½±åˆä¸€æ¬¡å‡ºç°åœ¨äº†å··å£ã€‚', 0, '2025-10-23 17:55:37.857842+00');

-- ----------------------------
-- Table structure for storyboards
-- ----------------------------
DROP TABLE IF EXISTS "public"."storyboards";
CREATE TABLE "public"."storyboards" (
  "storyboard_id" uuid NOT NULL DEFAULT gen_random_uuid(),
  "project_id" uuid NOT NULL,
  "source_text_id" uuid NOT NULL,
  "panel_index" int4 NOT NULL DEFAULT 0,
  "original_text_snippet" text COLLATE "pg_catalog"."default",
  "character_appearance" text COLLATE "pg_catalog"."default",
  "scene_and_lighting" text COLLATE "pg_catalog"."default",
  "camera_and_composition" text COLLATE "pg_catalog"."default",
  "expression_and_action" text COLLATE "pg_catalog"."default",
  "style_requirements" text COLLATE "pg_catalog"."default",
  "generated_image_url" varchar(1024) COLLATE "pg_catalog"."default",
  "created_at" timestamptz(6) DEFAULT timezone('utc'::text, now()),
  "updated_at" timestamptz(6) DEFAULT timezone('utc'::text, now()),
  "character_id" uuid
)
;
COMMENT ON COLUMN "public"."storyboards"."storyboard_id" IS 'å”¯ä¸€åˆ†é•œID (UUID)';
COMMENT ON COLUMN "public"."storyboards"."project_id" IS 'å¤–é”®ï¼Œå…³è”åˆ° projects(project_id)ï¼Œç”¨äºå¿«é€Ÿç´¢å¼•é¡¹ç›®ä¸‹çš„æ‰€æœ‰åˆ†é•œ';
COMMENT ON COLUMN "public"."storyboards"."source_text_id" IS 'å¤–é”®ï¼Œå…³è”åˆ° source_texts(text_id)ï¼Œæ ‡è¯†è¯¥åˆ†é•œå±äºå“ªä¸€ç« å°è¯´';
COMMENT ON COLUMN "public"."storyboards"."panel_index" IS 'åˆ†é•œåœ¨ç« èŠ‚å†…çš„æ’åºç´¢å¼• (ä¾‹å¦‚ 0, 1, 2, ...)ï¼Œç”¨äºæ’åº';
COMMENT ON COLUMN "public"."storyboards"."original_text_snippet" IS 'è¯¥åˆ†é•œå¯¹åº”çš„åŸå§‹å°è¯´æ–‡æœ¬ç‰‡æ®µ (æ–¹ä¾¿ç”¨æˆ·å¯¹ç…§)';
COMMENT ON COLUMN "public"."storyboards"."character_appearance" IS 'ã€è§’è‰²å¤–è²Œã€‘çš„è¯¦ç»†æè¿° (ä¾‹å¦‚ï¼šå¹´é¾„, æ€§åˆ«, èº«é«˜, ä½“å‹, å‘å‹, å‘è‰², çœ¼ç›, ç©¿ç€, ç‰¹æ®Šé…é¥°)';
COMMENT ON COLUMN "public"."storyboards"."scene_and_lighting" IS 'ã€åœºæ™¯ä¸å…‰ç…§ã€‘çš„è¯¦ç»†æè¿° (ä¾‹å¦‚ï¼šåœ°ç‚¹, æ—¶é—´, å¤©æ°”, å…‰æº, æ°›å›´)';
COMMENT ON COLUMN "public"."storyboards"."camera_and_composition" IS 'ã€é•œå¤´ä¸æ„å›¾ã€‘çš„è¯¦ç»†æè¿° (ä¾‹å¦‚ï¼šé•œå¤´æ™¯åˆ«(ç‰¹å†™/ä¸­æ™¯/å…¨æ™¯), è§’åº¦(æ­£é¢/å››åˆ†ä¹‹ä¸‰/ä½è§’åº¦/é«˜è§’åº¦), èšç„¦äºè§’è‰², åŠ¨æ€å§¿åŠ¿)';
COMMENT ON COLUMN "public"."storyboards"."expression_and_action" IS 'ã€è¡¨æƒ…ä¸åŠ¨ä½œã€‘çš„è¯¦ç»†æè¿° (ä¾‹å¦‚ï¼šæƒ…ç»ª, é¢éƒ¨è¡¨æƒ…, æ‰‹åŠ¿, åŠ¨ä½œ)';
COMMENT ON COLUMN "public"."storyboards"."style_requirements" IS 'ã€é£æ ¼è¦æ±‚ã€‘çš„è¯¦ç»†æè¿° (ä¾‹å¦‚ï¼šæ¼«ç”», é»‘ç™½ç½‘ç‚¹, æ¸…æ™°çº¿æ¡, åˆ†é•œæ„å›¾, é«˜æ¸…æ™°åº¦, è¯¦ç»†èƒŒæ™¯, è§’è‰²è®¾è®¡ä¸€è‡´æ€§)';
COMMENT ON COLUMN "public"."storyboards"."generated_image_url" IS 'AIGCç”Ÿæˆçš„æ¼«ç”»å›¾ç‰‡å­˜æ”¾åœ°å€ (URLæˆ–å¯¹è±¡å­˜å‚¨è·¯å¾„)';
COMMENT ON COLUMN "public"."storyboards"."created_at" IS 'åˆ†é•œåˆ›å»ºæ—¶é—´';
COMMENT ON COLUMN "public"."storyboards"."updated_at" IS 'åˆ†é•œæœ€åæ›´æ–°æ—¶é—´';
COMMENT ON COLUMN "public"."storyboards"."character_id" IS 'å¤–é”®ï¼Œå…³è”åˆ° characters(character_id)ï¼Œæ ‡è¯†è¯¥åˆ†é•œçš„ä¸»è¦è§’è‰² (å…è®¸ä¸ºç©º)';
COMMENT ON TABLE "public"."storyboards" IS 'åˆ†é•œè§„åˆ’è¡¨ (å­˜å‚¨æ¯ä¸ªå•ç‹¬çš„æ¼«ç”»åˆ†æ ¼)';

-- ----------------------------
-- Records of storyboards
-- ----------------------------
INSERT INTO "public"."storyboards" VALUES ('e5a8a6f0-1b3a-4f5e-8d9c-0a2a3a4a5b61', 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'd1b6e6e8-0b6f-4a81-8b43-6a107b7b1e2c', 0, 'æ¸…æ™¨ï¼Œé›¾æ°”å°šæœªæ•£å»ï¼Œå°‘å¹´ææ…•ç™½èƒŒç€è¡Œå›Š...', 'å¹´é¾„17å², ç”·æ€§, èº«é«˜178cm, èº«æä¿®é•¿, é»‘è‰²é•¿å‘æŸæˆé©¬å°¾, é»‘è‰²çœ¼çœ¸çŠ€åˆ©, ç©¿ç€æœ´ç´ çš„è“è‰²æ­¦é“è¢, èƒŒç€ä¸€ä¸ªç«¹åˆ¶èƒŒåŒ…å’Œä¸€æŠŠå‰‘', 'å±±è·¯, æ¸…æ™¨, æµ“é›¾, å¤ªé˜³åˆšå‡èµ·(æ¼«å°„å…‰æº), å®‰é™ä¸”é›¾æ°”ç¼­ç»•çš„æ°›å›´', 'ä¸­æ™¯é•œå¤´, ä»èƒŒåå‘ˆå››åˆ†ä¹‹ä¸‰è§’åº¦, èšç„¦äºè§’è‰²å›æœ›å±±é¡¶', 'æ€€æ—§, ä¾ä¾ä¸èˆ, æ‰­å¤´å›æœ›, é™æ­¢ç«™ç«‹', 'æ¼«ç”»é£æ ¼, é»‘ç™½ç½‘ç‚¹, æ¸…æ™°çš„çº¿æ¡, è¯¦ç»†çš„èƒŒæ™¯(å±±è„‰å’Œé›¾æ°”)', 'https://cdn.example.com/img/project_a_t1_p0.png', '2025-10-23 17:55:38.092062+00', '2025-10-24 02:19:27.170158+00', 'c0a1b2c3-1111-4f5e-8d9c-0a2a3a4a5b01');
INSERT INTO "public"."storyboards" VALUES ('e5a8a6f0-1b3a-4f5e-8d9c-0a2a3a4a5b62', 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'd1b6e6e8-0b6f-4a81-8b43-6a107b7b1e2c', 1, '...æ¯…ç„¶è½¬èº«ä¸‹å±±ã€‚ä»–ä¸çŸ¥é“ï¼Œæ­¤è¡Œå°†æ”¹å˜ä»–çš„ä¸€ç”Ÿã€‚', 'å¹´é¾„17å², ç”·æ€§, èº«é«˜178cm, èº«æä¿®é•¿, é»‘è‰²é•¿å‘æŸæˆé©¬å°¾, é»‘è‰²çœ¼çœ¸çŠ€åˆ©, ç©¿ç€æœ´ç´ çš„è“è‰²æ­¦é“è¢, èƒŒç€ä¸€ä¸ªç«¹åˆ¶èƒŒåŒ…å’Œä¸€æŠŠå‰‘', 'å±±è·¯, æ¸…æ™¨, æµ“é›¾, å¤ªé˜³åˆšå‡èµ·(æ¼«å°„å…‰æº), å®‰é™ä¸”é›¾æ°”ç¼­ç»•çš„æ°›å›´', 'å…¨æ™¯é•œå¤´, æ­£é¢è§’åº¦, èšç„¦äºè§’è‰²å‘å‰èµ°(æœå‘é•œå¤´), åŠ¨æ€å§¿åŠ¿(è¡Œèµ°ä¸­)', 'åšå®š, åšå†³, è¡¨æƒ…ä¸¥è‚ƒ, è‡ªä¿¡åœ°å¤§æ­¥å‘å‰', 'æ¼«ç”»é£æ ¼, é»‘ç™½ç½‘ç‚¹, æ¸…æ™°çš„çº¿æ¡, å¼ºè°ƒåŠ¨æ€çš„åˆ†é•œæ„å›¾', 'https://cdn.example.com/img/project_a_t1_p1.png', '2025-10-23 17:55:38.092062+00', '2025-10-24 02:19:27.452626+00', 'c0a1b2c3-1111-4f5e-8d9c-0a2a3a4a5b01');
INSERT INTO "public"."storyboards" VALUES ('e5a8a6f0-1b3a-4f5e-8d9c-0a2a3a4a5b63', 'f47ac10b-58cc-4372-a567-0e02b2c3d480', 'd1b6e6e8-0b6f-4a81-8b43-6a107b7b1e2d', 0, 'ç‹ç‚ç¼©åœ¨è§’è½ï¼Œå€Ÿç€é—ªç”µçš„å…‰èŠ’ï¼Œå¥¹çœ‹åˆ°é‚£ä¸ªé»‘å½±åˆä¸€æ¬¡å‡ºç°åœ¨äº†å··å£ã€‚', 'å¹´é¾„22å², å¥³æ€§, èº«é«˜165cm, ä¸­ç­‰èº«æ, å‡Œä¹±çš„é»‘è‰²çŸ­å‘, æƒŠæçš„å¤§çœ¼ç›, ç©¿ç€å®½å¤§çš„Tæ¤å’ŒçŸ­è£¤, æ²¡æœ‰é…é¥°', 'é»‘æš—çš„å…¬å¯“æˆ¿é—´å†…, å¤œæ™š, é›·é›¨, ä¸»è¦å…‰æºæ˜¯çª—å¤–çŸ­æš‚åˆºçœ¼çš„é—ªç”µ, é«˜å¯¹æ¯”åº¦, ç´§å¼ çš„æ°›å›´', 'ç‰¹å†™é•œå¤´, ä½è§’åº¦(ä»°è§†è§’è‰²), èšç„¦äºè§’è‰²çš„è„¸éƒ¨', 'ææƒ§, æƒŠæä¸‡åˆ†, çå¤§çœ¼ç›, ç”¨æ‰‹æ‚ä½å˜´å·´, èœ·ç¼©åœ¨è§’è½', 'æ¡æ¼«é£æ ¼, å…¨å½©, é«˜æ¸…æ™°åº¦, æˆå‰§æ€§çš„å…‰ç…§, ä¸“æ³¨äºæƒ…ç»ªè¡¨è¾¾', 'https://cdn.example.com/img/project_b_t1_p0.png', '2025-10-23 17:55:38.092062+00', '2025-10-24 02:19:27.720621+00', 'c0a1b2c3-2222-4f5e-8d9c-0a2a3a4a5b02');

-- ----------------------------
-- Table structure for users
-- ----------------------------
DROP TABLE IF EXISTS "public"."users";
CREATE TABLE "public"."users" (
  "user_id" uuid NOT NULL DEFAULT gen_random_uuid(),
  "username" varchar(100) COLLATE "pg_catalog"."default" NOT NULL,
  "email" varchar(255) COLLATE "pg_catalog"."default" NOT NULL,
  "hashed_password" varchar(255) COLLATE "pg_catalog"."default" NOT NULL,
  "credit_balance" int4 DEFAULT 0,
  "created_at" timestamptz(6) DEFAULT timezone('utc'::text, now()),
  "updated_at" timestamptz(6) DEFAULT timezone('utc'::text, now())
)
;
COMMENT ON COLUMN "public"."users"."user_id" IS 'å”¯ä¸€ç”¨æˆ·ID (UUID)';
COMMENT ON COLUMN "public"."users"."username" IS 'ç”¨æˆ·å (ç”¨äºç™»å½•ï¼Œå¿…é¡»å”¯ä¸€)';
COMMENT ON COLUMN "public"."users"."email" IS 'ç”µå­é‚®ç®± (ç”¨äºç™»å½•æˆ–æ‰¾å›å¯†ç ï¼Œå¿…é¡»å”¯ä¸€)';
COMMENT ON COLUMN "public"."users"."hashed_password" IS 'åŠ å¯†åçš„å¯†ç  (ä¾‹å¦‚ä½¿ç”¨bcryptæˆ–Argon2)';
COMMENT ON COLUMN "public"."users"."credit_balance" IS 'å¯ä½¿ç”¨é¢åº¦ (ä¾‹å¦‚: å‰©ä½™å¯ç”Ÿæˆå›¾ç‰‡å¼ æ•°æˆ–Tokenæ•°)';
COMMENT ON COLUMN "public"."users"."created_at" IS 'è´¦æˆ·åˆ›å»ºæ—¶é—´';
COMMENT ON COLUMN "public"."users"."updated_at" IS 'è´¦æˆ·ä¿¡æ¯æœ€åæ›´æ–°æ—¶é—´';
COMMENT ON TABLE "public"."users" IS 'ç”¨æˆ·ä¿¡æ¯è¡¨';

-- ----------------------------
-- Records of users
-- ----------------------------
INSERT INTO "public"."users" VALUES ('a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11', 'user_A', 'user_a@example.com', '$2b$12$dummyhashplaceholder1', 100, '2025-10-23 17:55:37.406081+00', '2025-10-23 17:55:37.406081+00');
INSERT INTO "public"."users" VALUES ('a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a22', 'user_B', 'user_b@example.com', '$2b$12$dummyhashplaceholder2', 50, '2025-10-23 17:55:37.406081+00', '2025-10-23 17:55:37.406081+00');
INSERT INTO "public"."users" VALUES ('19602e5a-7e68-4e91-8b67-ee27d2f29bd5', 'test_user_1864', 'test_user_1864@example.com', 'test_password_hash', 0, '2025-10-24 01:37:30.692544+00', '2025-10-24 01:37:30.692544+00');
INSERT INTO "public"."users" VALUES ('5cfa3d74-920b-4f57-9ad2-f02838b56c22', 'test_user_create', 'test_create@example.com', '$2b$12$Tew/dJ9.gg7waD9Bv.XV8us1PvcDl3jbym96kBJzw.kFUqUXnFhWe', 0, '2025-10-24 01:39:16.413759+00', '2025-10-24 01:39:16.413759+00');

-- ----------------------------
-- Primary Key structure for table characters
-- ----------------------------
ALTER TABLE "public"."characters" ADD CONSTRAINT "characters_pkey" PRIMARY KEY ("character_id");

-- ----------------------------
-- Triggers structure for table projects
-- ----------------------------
CREATE TRIGGER "set_projects_updated_at" BEFORE UPDATE ON "public"."projects"
FOR EACH ROW
EXECUTE PROCEDURE "public"."trigger_set_timestamp"();

-- ----------------------------
-- Primary Key structure for table projects
-- ----------------------------
ALTER TABLE "public"."projects" ADD CONSTRAINT "projects_pkey" PRIMARY KEY ("project_id");

-- ----------------------------
-- Primary Key structure for table source_texts
-- ----------------------------
ALTER TABLE "public"."source_texts" ADD CONSTRAINT "source_texts_pkey" PRIMARY KEY ("text_id");

-- ----------------------------
-- Triggers structure for table storyboards
-- ----------------------------
CREATE TRIGGER "set_storyboards_updated_at" BEFORE UPDATE ON "public"."storyboards"
FOR EACH ROW
EXECUTE PROCEDURE "public"."trigger_set_timestamp"();

-- ----------------------------
-- Primary Key structure for table storyboards
-- ----------------------------
ALTER TABLE "public"."storyboards" ADD CONSTRAINT "storyboards_pkey" PRIMARY KEY ("storyboard_id");

-- ----------------------------
-- Triggers structure for table users
-- ----------------------------
CREATE TRIGGER "set_users_updated_at" BEFORE UPDATE ON "public"."users"
FOR EACH ROW
EXECUTE PROCEDURE "public"."trigger_set_timestamp"();

-- ----------------------------
-- Uniques structure for table users
-- ----------------------------
ALTER TABLE "public"."users" ADD CONSTRAINT "users_username_key" UNIQUE ("username");
ALTER TABLE "public"."users" ADD CONSTRAINT "users_email_key" UNIQUE ("email");

-- ----------------------------
-- Primary Key structure for table users
-- ----------------------------
ALTER TABLE "public"."users" ADD CONSTRAINT "users_pkey" PRIMARY KEY ("user_id");

-- ----------------------------
-- Foreign Keys structure for table characters
-- ----------------------------
ALTER TABLE "public"."characters" ADD CONSTRAINT "characters_project_id_fkey" FOREIGN KEY ("project_id") REFERENCES "public"."projects" ("project_id") ON DELETE CASCADE ON UPDATE NO ACTION;

-- ----------------------------
-- Foreign Keys structure for table projects
-- ----------------------------
ALTER TABLE "public"."projects" ADD CONSTRAINT "projects_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."users" ("user_id") ON DELETE CASCADE ON UPDATE NO ACTION;

-- ----------------------------
-- Foreign Keys structure for table source_texts
-- ----------------------------
ALTER TABLE "public"."source_texts" ADD CONSTRAINT "source_texts_project_id_fkey" FOREIGN KEY ("project_id") REFERENCES "public"."projects" ("project_id") ON DELETE CASCADE ON UPDATE NO ACTION;

-- ----------------------------
-- Foreign Keys structure for table storyboards
-- ----------------------------
ALTER TABLE "public"."storyboards" ADD CONSTRAINT "storyboards_character_id_fkey" FOREIGN KEY ("character_id") REFERENCES "public"."characters" ("character_id") ON DELETE SET NULL ON UPDATE NO ACTION;
ALTER TABLE "public"."storyboards" ADD CONSTRAINT "storyboards_project_id_fkey" FOREIGN KEY ("project_id") REFERENCES "public"."projects" ("project_id") ON DELETE CASCADE ON UPDATE NO ACTION;
ALTER TABLE "public"."storyboards" ADD CONSTRAINT "storyboards_source_text_id_fkey" FOREIGN KEY ("source_text_id") REFERENCES "public"."source_texts" ("text_id") ON DELETE CASCADE ON UPDATE NO ACTION;






# æ–°çš„ç›®å½•ç»“æ„è¯´æ˜ - é¡¹ç›®é‡æ„å®Œæˆ

## ğŸ‰ é‡æ„å®Œæˆï¼

æ ¹æ®log.txtä¸­çš„å»ºè®®ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸå°†`main.py`æ‹†åˆ†ä¸ºæ›´æ¸…æ™°ã€æ›´æ˜“ç»´æŠ¤çš„ç»“æ„ã€‚

## ğŸ“ æ–°çš„ç›®å½•ç»“æ„

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ db/                    # æ•°æ®åº“å±‚ï¼ˆå·²å®Œæˆï¼‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ client.py          # Supabaseå®¢æˆ·ç«¯ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ crud.py            # æ•°æ®åº“CRUDæ“ä½œ
â”‚   â”‚   â””â”€â”€ models.py          # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                   # APIè·¯ç”±å±‚ï¼ˆæ–°å»ºï¼‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ storyboard.py      # åˆ†é•œç›¸å…³API
â”‚   â”‚   â””â”€â”€ project.py         # é¡¹ç›®ç®¡ç†API
â”‚   â”‚
â”‚   â”œâ”€â”€ services/              # AIæœåŠ¡å±‚ï¼ˆæ–°å»ºï¼‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ ai_parser.py       # AIæ–‡æœ¬è§£æå’Œåˆ†é•œç”Ÿæˆ
â”‚   â”‚
â”‚   â””â”€â”€ main.py                # åº”ç”¨ä¸»å…¥å£ï¼ˆé‡æ„ï¼‰
â”‚
â”œâ”€â”€ config.py                  # é…ç½®ç®¡ç†
â”œâ”€â”€ test_db.py                 # æ•°æ®åº“æµ‹è¯•
â””â”€â”€ requirements.txt           # ä¾èµ–ç®¡ç†
```

## ğŸ”§ å„å±‚èŒè´£è¯´æ˜

### 1. **serviceså±‚** - AIæœåŠ¡å±‚
**æ–‡ä»¶**: `backend/app/services/ai_parser.py`
**èŒè´£**:
- è°ƒç”¨ä¸ƒç‰›äº‘AI APIè¿›è¡Œæ–‡æœ¬å¤„ç†
- æ™ºèƒ½åˆ†æ®µï¼šå°†é•¿ç¯‡å°è¯´æŒ‰æƒ…èŠ‚èŠ‚ç‚¹åˆ†æ®µ
- åˆ†é•œç”Ÿæˆï¼šå°†æ–‡æœ¬è½¬æ¢ä¸ºæ¼«ç”»åˆ†é•œç»“æ„
- é”™è¯¯å¤„ç†å’Œé™çº§ç­–ç•¥

**ç‰¹ç‚¹**:
- çº¯ä¸šåŠ¡é€»è¾‘ï¼Œä¸æ¶‰åŠHTTPè¯·æ±‚/å“åº”
- ä¸ç›´æ¥æ“ä½œæ•°æ®åº“ï¼Œé€šè¿‡ä¸Šå±‚APIè°ƒç”¨
- å¯ç‹¬ç«‹æµ‹è¯•å’Œå¤ç”¨
- ä¸ºåä½œè€…é¢„ç•™æ‰©å±•ç©ºé—´ï¼ˆå¦‚æ–‡ç”Ÿå›¾åŠŸèƒ½ï¼‰

### 2. **apiå±‚** - APIè·¯ç”±å±‚
**æ–‡ä»¶**: 
- `backend/app/api/storyboard.py` - åˆ†é•œç›¸å…³API
- `backend/app/api/project.py` - é¡¹ç›®ç®¡ç†API

**èŒè´£**:
- æ¥æ”¶å‰ç«¯Vueé¡µé¢çš„HTTPè¯·æ±‚
- è°ƒç”¨serviceså±‚è¿›è¡ŒAIå¤„ç†
- è°ƒç”¨dbå±‚è¿›è¡Œæ•°æ®å­˜å‚¨
- è¿”å›æ ‡å‡†åŒ–çš„JSONå“åº”

**ç‰¹ç‚¹**:
- åªå¤„ç†HTTPè¯·æ±‚/å“åº”ï¼Œä¸åŒ…å«ä¸šåŠ¡é€»è¾‘
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’ŒçŠ¶æ€ç è¿”å›
- ä¸ºå‰ç«¯æä¾›æ¸…æ™°çš„æ•°æ®æ¥å£

### 3. **main.py** - åº”ç”¨ç»„è£…
**æ–‡ä»¶**: `backend/app/main.py`
**èŒè´£**:
- åº”ç”¨å¯åŠ¨å’Œé…ç½®
- ä¸­é—´ä»¶è®¾ç½®ï¼ˆCORSç­‰ï¼‰
- è·¯ç”±ç»„è£…å’ŒæŒ‚è½½
- æ•°æ®åº“è¿æ¥ç®¡ç†
- å¥åº·æ£€æŸ¥æ¥å£

**ç‰¹ç‚¹**:
- ä¿æŒæç®€ï¼Œä¸åŒ…å«ä¸šåŠ¡é€»è¾‘
- é€šè¿‡å¯¼å…¥å’Œç»„è£…å…¶ä»–æ¨¡å—å®ŒæˆåŠŸèƒ½
- ä¾¿äºåä½œè€…æ·»åŠ æ–°çš„APIè·¯ç”±
- æ¸…æ™°çš„å¯åŠ¨å’Œå…³é—­æµç¨‹

## ğŸš€ åä½œä¼˜åŠ¿

### å¯¹æ‚¨ï¼ˆåˆ†é•œåŠŸèƒ½ï¼‰ï¼š
- ä¸“æ³¨äº `services/ai_parser.py` å’Œ `api/storyboard.py`
- å¯ä»¥ç‹¬ç«‹å¼€å‘å’Œæµ‹è¯•AIè§£æåŠŸèƒ½
- ä¸å½±å“å…¶ä»–åŠŸèƒ½æ¨¡å—

### å¯¹åä½œè€…ï¼ˆæ–‡ç”Ÿå›¾åŠŸèƒ½ï¼‰ï¼š
- å¯ä»¥åˆ›å»º `services/ai_image.py` å’Œ `api/image_gen.py`
- åœ¨ `main.py` ä¸­ç®€å•æ·»åŠ è·¯ç”±æŒ‚è½½
- å®Œå…¨ç‹¬ç«‹çš„å¼€å‘ç©ºé—´

## ğŸ“ è¯¦ç»†æ³¨é‡Šè¯´æ˜

æ¯ä¸ªæ–‡ä»¶éƒ½åŒ…å«äº†è¯¦ç»†çš„æ³¨é‡Šï¼Œè¯´æ˜ï¼š
- æ–‡ä»¶çš„ä¸»è¦åŠŸèƒ½å’ŒèŒè´£
- æ¯ä¸ªå‡½æ•°çš„ä½œç”¨å’Œå‚æ•°
- è®¾è®¡åŸåˆ™å’Œæ¶æ„è€ƒè™‘
- ä½¿ç”¨åœºæ™¯å’Œæ‰©å±•æ–¹å‘

## ğŸ”„ æ•°æ®æµè¯´æ˜

```
å‰ç«¯Vueé¡µé¢ 
    â†“ HTTPè¯·æ±‚
APIè·¯ç”±å±‚ (storyboard.py/project.py)
    â†“ è°ƒç”¨
AIæœåŠ¡å±‚ (ai_parser.py)
    â†“ è°ƒç”¨
ä¸ƒç‰›äº‘AI API
    â†“ è¿”å›
AIæœåŠ¡å±‚å¤„ç†ç»“æœ
    â†“ è¿”å›
APIè·¯ç”±å±‚
    â†“ è°ƒç”¨
æ•°æ®åº“å±‚ (db/)
    â†“ è¿”å›
APIè·¯ç”±å±‚
    â†“ HTTPå“åº”
å‰ç«¯Vueé¡µé¢
```

## âœ… æµ‹è¯•å»ºè®®

ç°åœ¨å¯ä»¥æµ‹è¯•æ–°çš„ç»“æ„ï¼š

```bash
cd backend
venv\Scripts\activate
python test_db.py  # æµ‹è¯•æ•°æ®åº“è¿æ¥
uvicorn app.main:app --reload  # å¯åŠ¨APIæœåŠ¡
```

è®¿é—® `http://localhost:8000/docs` æŸ¥çœ‹APIæ–‡æ¡£ï¼Œæ‰€æœ‰æ¥å£éƒ½åº”è¯¥æ­£å¸¸å·¥ä½œï¼

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **æµ‹è¯•æ‰€æœ‰APIæ¥å£**ç¡®ä¿åŠŸèƒ½æ­£å¸¸
2. **åä½œè€…å¯ä»¥å¼€å§‹æ·»åŠ æ–‡ç”Ÿå›¾åŠŸèƒ½**
3. **æ ¹æ®éœ€è¦æ·»åŠ æ›´å¤šAPIè·¯ç”±**
4. **ä¼˜åŒ–é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•**

é‡æ„å®Œæˆï¼ç°åœ¨ä»£ç ç»“æ„æ›´åŠ æ¸…æ™°ï¼Œä¾¿äºç»´æŠ¤å’Œåä½œå¼€å‘ã€‚




æˆ‘ä»¬ç°åœ¨çš„æ ¸å¿ƒä»»åŠ¡å°±æ˜¯æ‰“é€šâ€œ**å‰ç«¯è¾“å…¥ -\> åç«¯AIå¤„ç† -\> æ•°æ®æŒä¹…åŒ– -\> å‰ç«¯åŠ è½½&ç¼–è¾‘**â€è¿™ä¸ªé—­ç¯ã€‚

ä»¥ä¸‹æ˜¯æˆ‘ä»¬éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶åŠå…¶èŒè´£ï¼Œä»¥åŠæ¸…æ™°çš„æ•°æ®æµè½¬è¯´æ˜ã€‚

-----

### ç›®æ ‡æ•°æ®æµï¼ˆä¿®å¤åï¼‰

1.  **å‰ç«¯ (æ–‡æœ¬åˆ†æé¡µ)**: ç”¨æˆ·åœ¨ `script-analyzer.vue` é¡µé¢ï¼ˆæ­¤æ—¶å·²ç™»å½•å¹¶é€‰å®šäº†`project_id`ï¼‰è¾“å…¥å°è¯´æ–‡æœ¬ï¼Œç‚¹å‡»â€œç”Ÿæˆåˆ†é•œâ€ã€‚
2.  **å‰ç«¯ (APIè°ƒç”¨)**: `submitText()` æ–¹æ³•è°ƒç”¨åç«¯ `POST /api/v1/parse` æ¥å£ï¼Œ**å¿…é¡»**æºå¸¦ `{ text, title, project_id }`ã€‚
3.  **åç«¯ (APIå±‚)**: `backend/app/api/storyboard.py` ä¸­çš„ `parse_text` æ¥å£æ¥æ”¶è¯·æ±‚ã€‚
4.  **åç«¯ (å­˜åŸæ–‡)**: `parse_text` **é¦–å…ˆ**è°ƒç”¨ `crud.py` ä¸­çš„ `create_source_text()`ï¼Œå°†å°è¯´åŸæ–‡å­˜å…¥ `source_texts` è¡¨ï¼Œå¹¶è·å¾—ä¸€ä¸ª`text_id`ã€‚
5.  **åç«¯ (AIå¤„ç†)**: `parse_text` è°ƒç”¨ `backend/app/services/ai_parser.py`ã€‚
6.  **åç«¯ (AIæœåŠ¡å±‚)**: `ai_parser.py` **(éœ€ä¿®æ”¹)** è°ƒç”¨LLMï¼Œè¦æ±‚AIè¿”å›ä¸€ä¸ªåŒ…å«`"characters": [...]`å’Œ`"storyboards": [...]`çš„JSONã€‚
7.  **åç«¯ (å­˜AIæ•°æ®)**: `parse_text` æ”¶åˆ°AIçš„JSONåï¼š
      * éå†`characters`åˆ—è¡¨ï¼Œè°ƒç”¨ `crud.py` çš„ `create_character()` å­˜å…¥ `characters` è¡¨ã€‚
      * éå†`storyboards`åˆ—è¡¨ï¼Œè°ƒç”¨ `crud.py` çš„ **`create_storyboard_panel()`** (æ–°å‡½æ•°) å­˜å…¥ `storyboards` è¡¨ï¼ˆå¹¶å…³è”`project_id`, `text_id`, `character_id`ï¼‰ã€‚
8.  **åç«¯ (APIå“åº”)**: `parse_text` **ä¸å†è¿”å›**åºå¤§çš„JSONæ•°æ®ï¼Œè€Œæ˜¯è¿”å› `{ "ok": true, "project_id": "...", "text_id": "..." }`ã€‚
9.  **å‰ç«¯ (è·³è½¬)**: `script-analyzer.vue` æ”¶åˆ°æˆåŠŸçš„å“åº”åï¼Œ**ä½¿ç”¨IDè·³è½¬**åˆ°åˆ†é•œè§„åˆ’é¡µï¼š`uni.navigateTo({ url: \`/pages/storyboard/layout-planner?project\_id=...\&text\_id=...\` })\`ã€‚
10. **å‰ç«¯ (åˆ†é•œé¡µ)**: `layout-planner.vue` åœ¨ `onLoad` æ—¶è·å– `text_id`ã€‚
11. **å‰ç«¯ (åŠ è½½æ•°æ®)**: `layout-planner.vue` è°ƒç”¨**æ–°çš„** `GET /api/v1/storyboards?text_id=...` æ¥å£ä»æ•°æ®åº“è·å–è¯¥ç« èŠ‚çš„æ‰€æœ‰åˆ†é•œæ•°æ®ã€‚
12. **å‰ç«¯ (ç¼–è¾‘&ä¿å­˜)**: ç”¨æˆ·åœ¨ `layout-planner.vue` ä¿®æ”¹*å•ä¸ª*åˆ†é•œé¢æ¿åï¼Œç‚¹å‡»ä¿å­˜ï¼Œè°ƒç”¨**æ–°çš„** `PUT /api/v1/storyboard/{storyboard_id}` æ¥å£ï¼Œä»…æ›´æ–°è¯¥æ¡æ•°æ®ã€‚

-----

1. ç”¨æˆ·ä¸Šä¼ æ–°ç« èŠ‚ â†’ POST /api/v1/parse
2. ä¿å­˜åŸæ–‡ â†’ source_textsè¡¨
3. æŸ¥è¯¢é¡¹ç›®å·²å­˜åœ¨è§’è‰² â†’ charactersè¡¨
4. å°†å·²å­˜åœ¨è§’è‰²åˆ—è¡¨ä¼ é€’ç»™AI
5. AIå¤„ç†æ–‡æœ¬ï¼Œåªç”Ÿæˆæ–°è§’è‰²çš„description
6. AIä¸ºæ‰€æœ‰è§’è‰²ç”Ÿæˆcharacter_appearance
7. åç«¯åªåˆ›å»ºæ–°è§’è‰²ï¼Œè·³è¿‡å·²å­˜åœ¨è§’è‰²
8. ä¿å­˜åˆ†é•œï¼Œæ­£ç¡®å…³è”è§’è‰²ID





### 1\. æ¨¡å‹(LLM)éœ€è¦å¤„ç†å’Œè¾“å…¥çš„æ•°æ®

ä½ é—®åˆ°äº†æ¨¡å‹éœ€è¦å¤„ç†å“ªäº›æ•°æ®ï¼Œè¿™éå¸¸å…³é”®ã€‚ä½ éœ€è¦ä¿®æ”¹AIçš„æç¤ºè¯ï¼ˆPromptï¼‰ï¼Œè®©å®ƒè¾“å‡º*åŒæ—¶*ç¬¦åˆ`characters`è¡¨å’Œ`storyboards`è¡¨ç»“æ„çš„JSONã€‚

**æ–‡ä»¶**: `backend/app/services/ai_parser.py`

**LLM (AI) çš„è¾“å‡ºJSONæ ¼å¼ï¼ˆå»ºè®®ï¼‰ï¼š**

```json
{
  "characters": [
    {
      "name": "ææ…•ç™½",
      "description": "å¹´é¾„17å², ç”·æ€§, èº«é«˜178cm, èº«æä¿®é•¿, é»‘è‰²é•¿å‘æŸæˆé©¬å°¾, é»‘è‰²çœ¼çœ¸çŠ€åˆ©, ç©¿ç€æœ´ç´ çš„è“è‰²æ­¦é“è¢, èƒŒç€ä¸€ä¸ªç«¹åˆ¶èƒŒåŒ…å’Œä¸€æŠŠå‰‘"
    },
    {
      "name": "ç‹ç‚", 
      "description": "å¹´é¾„22å², å¥³æ€§, èº«é«˜165cm, ä¸­ç­‰èº«æ, å‡Œä¹±çš„é»‘è‰²çŸ­å‘..."
    }
  ],
  "storyboards": [
    {
      "original_text_snippet": "æ¸…æ™¨ï¼Œé›¾æ°”å°šæœªæ•£å»ï¼Œå°‘å¹´ææ…•ç™½èƒŒç€è¡Œå›Š...",
      "character_name": "ææ…•ç™½", // AIéœ€è¦æä¾›è¿™ä¸ªåå­—ï¼Œä¾›åç«¯åŒ¹é…ID
      "character_appearance": "ææ…•ç™½ç©¿ç€æœ´ç´ çš„è“è‰²æ­¦é“è¢, èƒŒç€èƒŒåŒ…å’Œå‰‘", // åˆ†é•œç‰¹å®šçš„å¤–è²Œï¼ˆå¯èƒ½ä¸åŸºç¡€è®¾å®šä¸åŒï¼Œä¾‹å¦‚â€œè¡£æœç ´æŸâ€ï¼‰
      "scene_and_lighting": "å±±è·¯, æ¸…æ™¨, æµ“é›¾, å¤ªé˜³åˆšå‡èµ·(æ¼«å°„å…‰æº), å®‰é™ä¸”é›¾æ°”ç¼­ç»•çš„æ°›å›´",
      "camera_and_composition": "ä¸­æ™¯é•œå¤´, ä»èƒŒåå‘ˆå››åˆ†ä¹‹ä¸‰è§’åº¦, èšç„¦äºè§’è‰²å›æœ›å±±é¡¶",
      "expression_and_action": "æ€€æ—§, ä¾ä¾ä¸èˆ, æ‰­å¤´å›æœ›, é™æ­¢ç«™ç«‹",
      "style_requirements": "æ¼«ç”»é£æ ¼, é»‘ç™½ç½‘ç‚¹, æ¸…æ™°çš„çº¿æ¡"
    },
    {
      "original_text_snippet": "ç‹ç‚ç¼©åœ¨è§’è½ï¼Œå€Ÿç€é—ªç”µçš„å…‰èŠ’...",
      "character_name": "ç‹ç‚", // AIæä¾›åå­—
      "character_appearance": "ç‹ç‚ç©¿ç€å®½å¤§çš„Tæ¤å’ŒçŸ­è£¤, æƒŠæä¸‡åˆ†",
      "scene_and_lighting": "é»‘æš—çš„å…¬å¯“æˆ¿é—´å†…, å¤œæ™š, é›·é›¨, é—ªç”µ",
      "camera_and_composition": "ç‰¹å†™é•œå¤´, ä½è§’åº¦(ä»°è§†è§’è‰²), èšç„¦äºè§’è‰²çš„è„¸éƒ¨",
      "expression_and_action": "ææƒ§, çå¤§çœ¼ç›, ç”¨æ‰‹æ‚ä½å˜´å·´, èœ·ç¼©",
      "style_requirements": "æ¡æ¼«é£æ ¼, å…¨å½©, æˆå‰§æ€§çš„å…‰ç…§"
    }
  ]
}
```

-----

### 2\. é¡¹ç›®ä¸­éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶

ä»¥ä¸‹æ˜¯ä½ éœ€è¦é‡ç‚¹ä¿®æ”¹çš„æ–‡ä»¶ï¼Œä»¥ä¾¿ç”¨Cursorå®ç°ä¸Šè¿°æ•°æ®æµï¼š

#### åç«¯ (Backend)

**1. `backend/app/db/crud.py`**

  * **èŒè´£**: å®é™…æ‰§è¡Œæ•°æ®åº“æ“ä½œã€‚
  * **ä¿®æ”¹**:
      * **åˆ é™¤/å¼ƒç”¨**: `save_storyboard` å’Œ `load_storyboard`ã€‚è¿™ä¸¤ä¸ªå‡½æ•°ç›®å‰é”™è¯¯åœ°è¯»å†™ `projects.description` å­—æ®µï¼Œå¿…é¡»åœç”¨ã€‚
      * **[æ–°å¢å‡½æ•°] `create_storyboard_panel`**:
        ```python
        # (ä½ éœ€è¦æ·»åŠ è¿™ä¸ªæ–°å‡½æ•°)
        async def create_storyboard_panel(
            project_id: str, 
            source_text_id: str, 
            panel_index: int, 
            panel_data: dict, 
            character_id: Optional[str] = None
        ) -> Optional[dict]:
            """åˆ›å»ºä¸€æ¡æ–°çš„åˆ†é•œé¢æ¿è®°å½•"""
            try:
                storyboard_data = {
                    "storyboard_id": str(uuid.uuid4()),
                    "project_id": project_id,
                    "source_text_id": source_text_id,
                    "panel_index": panel_index,
                    "original_text_snippet": panel_data.get("original_text_snippet"),
                    "character_appearance": panel_data.get("character_appearance"),
                    "scene_and_lighting": panel_data.get("scene_and_lighting"),
                    "camera_and_composition": panel_data.get("camera_and_composition"),
                    "expression_and_action": panel_data.get("expression_and_action"),
                    "style_requirements": panel_data.get("style_requirements"),
                    "character_id": character_id
                }
                result = await db_client.insert("storyboards", storyboard_data)
                return result
            except Exception as e:
                print(f"âŒ åˆ›å»ºåˆ†é•œé¢æ¿å¤±è´¥: {e}")
                return None
        ```
      * **[æ–°å¢å‡½æ•°] `get_storyboards_by_text_id`**:
        ```python
        # (ä½ éœ€è¦æ·»åŠ è¿™ä¸ªæ–°å‡½æ•°)
        async def get_storyboards_by_text_id(text_id: str) -> List[dict]:
            """æ ¹æ® source_text_id è·å–æ‰€æœ‰åˆ†é•œé¢æ¿ï¼ŒæŒ‰ç´¢å¼•æ’åº"""
            try:
                # Supabase/PostgRESTçš„ .order() éœ€è¦åœ¨ client.py ä¸­æ”¯æŒï¼Œ
                # å¦‚æœ client.py ä¸æ”¯æŒ orderï¼Œä¸€ä¸ªç®€å•çš„ select ä¹Ÿå¯ä»¥ï¼Œåç»­åœ¨Pythonä¸­æ’åº
                # å‡è®¾ client.py çš„ select æ”¯æŒ order (å¦‚æœä¸æ”¯æŒï¼Œå°±éœ€è¦ä¿®æ”¹ client.py)
                # 
                # ä¸´æ—¶çš„ç®€å•å®ç° (å¦‚æœ client.py ä¸æ”¯æŒæ’åº):
                results = await db_client.select(
                    "storyboards",
                    filters={"source_text_id": text_id}
                )
                # åœ¨Pythonä¸­æ’åº
                results.sort(key=lambda x: x.get('panel_index', 0))
                return results
            except Exception as e:
                print(f"âŒ è·å–åˆ†é•œåˆ—è¡¨å¤±è´¥: {e}")
                return []
        ```
      * **[æ–°å¢å‡½æ•°] `update_storyboard_panel`**:
        ```python
        # (ä½ éœ€è¦æ·»åŠ è¿™ä¸ªæ–°å‡½æ•°)
        async def update_storyboard_panel(storyboard_id: str, updates: dict) -> bool:
            """æ›´æ–°å•ä¸ªåˆ†é•œé¢æ¿"""
            try:
                # æ¸…ç†æ‰ä¸»é”®ï¼Œé˜²æ­¢æ›´æ–°ä¸»é”®
                if "storyboard_id" in updates:
                    del updates["storyboard_id"]
                
                await db_client.update(
                    "storyboards",
                    updates,
                    {"storyboard_id": storyboard_id}
                )
                return True
            except Exception as e:
                print(f"âŒ æ›´æ–°åˆ†é•œé¢æ¿å¤±è´¥: {e}")
                return False
        ```

**2. `backend/app/services/ai_parser.py`**

  * **èŒè´£**: è°ƒç”¨ LLM å¹¶è¿”å›æ ‡å‡† JSONã€‚
  * **ä¿®æ”¹**:
      * **`generate_storyboard_for_segment`**: ä¿®æ”¹æ­¤å‡½æ•°ä¸­çš„ `messages` (Prompt)ï¼Œè¦æ±‚AIä¸¥æ ¼æŒ‰ç…§æˆ‘ä¸Šé¢æä¾›çš„ **"LLM (AI) çš„è¾“å‡ºJSONæ ¼å¼ï¼ˆå»ºè®®ï¼‰"** è¿”å›æ•°æ®ï¼ˆåŒ…å«`characters`å’Œ`storyboards`åˆ—è¡¨ï¼‰ã€‚
      * **`call_qiniu_api`**: ç¡®ä¿å®ƒèƒ½æ­£ç¡®è§£æLLMè¿”å›çš„JSONã€‚

**3. `backend/app/api/storyboard.py`**

  * **èŒè´£**: æš´éœ² HTTP æ¥å£ç»™å‰ç«¯ã€‚
  * **ä¿®æ”¹**:
      * **`parse_text` (POST `/api/v1/parse`)**:
        1.  ç¡®ä¿å·²å¯¼å…¥ `create_source_text`, `create_character`, `create_storyboard_panel`ã€‚
        2.  **(æ–°å¢)** è°ƒç”¨ `create_source_text` ä¿å­˜åŸæ–‡ï¼Œè·å– `text_id`ã€‚
        3.  è°ƒç”¨ `ai_parser.py` è·å–AIçš„JSONï¼ˆ`{"characters": ..., "storyboards": ...}`ï¼‰ã€‚
        4.  **(æ–°å¢)** åˆ›å»ºä¸€ä¸ªå­—å…¸ `name_to_id_map = {}`ã€‚
        5.  **(æ–°å¢)** éå† `response['characters']`ï¼š
              * è°ƒç”¨ `create_character` ä¿å­˜è§’è‰²ã€‚
              * å°†è¿”å›çš„ `character_id` å­˜å…¥ `name_to_id_map[char['name']] = new_char_id`ã€‚
        6.  **(ä¿®æ”¹)** æ›¿æ¢æ‰æ—§çš„ `save_storyboard` é€»è¾‘ã€‚
        7.  **(æ–°å¢)** éå† `response['storyboards']` (å¸¦ `i` ç´¢å¼•)ï¼š
              * `char_name = panel.get("character_name")`
              * `char_id = name_to_id_map.get(char_name)` (å¦‚æœæ‰¾ä¸åˆ°å°±æ˜¯ `None`)
              * è°ƒç”¨ `create_storyboard_panel(project_id=req.project_id, source_text_id=text_id, panel_index=i, panel_data=panel, character_id=char_id)`ã€‚
        8.  **(ä¿®æ”¹)** `return` è¯­å¥ï¼šå¿…é¡»è¿”å› `{"ok": True, "project_id": req.project_id, "text_id": text_id}`ã€‚
      * **`save_storyboard_endpoint` (POST `/api/v1/save-storyboard`)**:
          * è¿™ä¸ªæ¥å£çš„é€»è¾‘æ˜¯é”™çš„ï¼ˆä¿å­˜åˆ°`projects`è¡¨ï¼‰ï¼Œå»ºè®®**åˆ é™¤**ã€‚
      * **[æ–°å¢API] `get_storyboards` (GET `/api/v1/storyboards`)**:
        ```python
        # (ä½ éœ€è¦æ·»åŠ è¿™ä¸ªæ–°API)
        from fastapi import Query

        @router.get("/api/v1/storyboards", tags=["Storyboard"])
        async def get_storyboards(text_id: str = Query(...)):
            """æ ¹æ® text_id è·å–åˆ†é•œé¢æ¿åˆ—è¡¨"""
            if not db_client.is_connected:
                raise HTTPException(status_code=500, detail="æ•°æ®åº“æœªè¿æ¥")
            try:
                panels = await get_storyboards_by_text_id(text_id)
                return {"ok": True, "storyboards": panels}
            except Exception as e:
                raise HTTPException(status_code=500, detail=f"è·å–åˆ†é•œå¤±è´¥: {str(e)}")
        ```
      * **[æ–°å¢API] `update_storyboard` (PUT `/api/v1/storyboard/{storyboard_id}`)**:
        ```python
        # (ä½ éœ€è¦æ·»åŠ è¿™ä¸ªæ–°API)
        from pydantic import BaseModel

        class StoryboardPanelUpdate(BaseModel):
            # å®šä¹‰å…è®¸å‰ç«¯ä¿®æ”¹çš„å­—æ®µ
            original_text_snippet: Optional[str] = None
            character_appearance: Optional[str] = None
            scene_and_lighting: Optional[str] = None
            camera_and_composition: Optional[str] = None
            expression_and_action: Optional[str] = None
            style_requirements: Optional[str] = None
            character_id: Optional[str] = None

        @router.put("/api/v1/storyboard/{storyboard_id}", tags=["Storyboard"])
        async def update_storyboard(storyboard_id: str, updates: StoryboardPanelUpdate):
            """æ›´æ–°å•ä¸ªåˆ†é•œé¢æ¿"""
            if not db_client.is_connected:
                raise HTTPException(status_code=500, detail="æ•°æ®åº“æœªè¿æ¥")
            try:
                # .dict(exclude_unset=True) ç¡®ä¿åªæ›´æ–°ä¼ å…¥çš„å­—æ®µ
                success = await update_storyboard_panel(storyboard_id, updates.dict(exclude_unset=True))
                if success:
                    return {"ok": True, "message": "æ›´æ–°æˆåŠŸ"}
                else:
                    raise HTTPException(status_code=500, detail="æ›´æ–°å¤±è´¥")
            except Exception as e:
                raise HTTPException(status_code=500, detail=f"æ›´æ–°å¤±è´¥: {str(e)}")
        ```

-----

#### å‰ç«¯ (Frontend)

**1. `frontend/pages/storyboard/script-analyzer.vue`**

  * **èŒè´£**: æ”¶é›†æ–‡æœ¬ï¼Œè°ƒç”¨è§£æAPIï¼Œç„¶åè·³è½¬ã€‚
  * **ä¿®æ”¹**:
      * `data()`: ç¡®ä¿ `project_id` å¯ä»¥ä» `onLoad` (å¦‚æœä»é¡¹ç›®åˆ—è¡¨é¡µè·³è½¬è¿‡æ¥) æˆ– `authManager` (å¦‚æœå­˜åœ¨) ä¸­è·å–ã€‚
      * `submitText()`:
          * ä¿®æ”¹ `uni.request` çš„ `data`ï¼Œ**å¿…é¡»**åŒ…å« `project_id: this.project_id`ã€‚
          * ä¿®æ”¹ `success` å›è°ƒä¸­çš„è·³è½¬é€»è¾‘ï¼š
            ```javascript
            // [æ—§ä»£ç ]
            // uni.navigateTo({
            //   url: `/pages/storyboard/layout-planner?storyboard=${encodeURIComponent(JSON.stringify(response.data.storyboard))}`
            // })

            // [æ–°ä»£ç ]
            if (response.data.ok) {
              uni.showToast({ title: 'ç”ŸæˆæˆåŠŸï¼å‡†å¤‡è·³è½¬...', icon: 'success' });
              setTimeout(() => {
                uni.navigateTo({
                  url: `/pages/storyboard/layout-planner?project_id=${response.data.project_id}&text_id=${response.data.text_id}`
                })
              }, 1500)
            } else {
              // å¤„ç†é”™è¯¯
            }
            ```

**2. `frontend/pages/storyboard/layout-planner.vue`**

  * **èŒè´£**: (å…³é”®é¡µé¢) åŠ è½½ã€æ˜¾ç¤ºã€ç¼–è¾‘åˆ†é•œé¢æ¿ã€‚
  * **ä¿®æ”¹ (è¿™å—æ”¹åŠ¨æœ€å¤§)**:
      * `data()`:
          * `pages: []` -\> **`panels: []`** (æ•°æ®ç»“æ„å¿…é¡»æ”¹å˜ï¼Œä»¥åŒ¹é…æ•°æ®åº“)ã€‚
          * `projectId: null` (ä¿ç•™)ã€‚
          * **(æ–°å¢)** `textId: null`ã€‚
      * `onLoad(options)`:
          * **åˆ é™¤** `options.storyboard` çš„æ‰€æœ‰ç›¸å…³é€»è¾‘ã€‚
          * **æ›¿æ¢** `loadExistingStoryboard` çš„é€»è¾‘ã€‚
          * **(æ–°å¢)**
            ```javascript
            onLoad(options) {
              if (options.project_id && options.text_id) {
                this.projectId = options.project_id;
                this.textId = options.text_id;
                this.loadPanelsData(); // è°ƒç”¨æ–°çš„åŠ è½½å‡½æ•°
              } else {
                uni.showToast({ title: 'ç¼ºå°‘é¡¹ç›®æˆ–æ–‡æœ¬ID', icon: 'none' });
                // ...è¿”å›é€»è¾‘
              }
            }
            ```
      * **[æ–°å¢æ–¹æ³•] `loadPanelsData`**:
        ```javascript
        async loadPanelsData() {
          this.isLoading = true;
          uni.showLoading({ title: 'åŠ è½½åˆ†é•œä¸­...' });
          try {
            const response = await uni.request({
              url: `http://localhost:8000/api/v1/storyboards?text_id=${this.textId}`,
              method: 'GET'
            });
            if (response.statusCode === 200 && response.data.ok) {
              this.panels = response.data.storyboards; // å°†æ•°æ®å­˜å…¥ panels
              this.hasUnsavedChanges = false;
            } else {
              throw new Error('åŠ è½½å¤±è´¥');
            }
          } catch (e) {
            uni.showToast({ title: e.message || 'åŠ è½½æ•°æ®å¤±è´¥', icon: 'none' });
          } finally {
            this.isLoading = false;
            uni.hideLoading();
          }
        }
        ```
      * **Template (HTMLéƒ¨åˆ†)**:
          * ä½ å¿…é¡»**é‡æ„**æ¨¡æ¿ã€‚åˆ é™¤ `v-for="(page, pageIndex) in pages"` çš„å¤–å±‚å¾ªç¯ã€‚
          * **æ›¿æ¢**ä¸ºä¸€å±‚å¾ªç¯ï¼š `v-for="(panel, panelIndex) in panels" :key="panel.storyboard_id"`ã€‚
          * æ¨¡æ¿ä¸­æ‰€æœ‰å¯¹ `page.panels` çš„å¼•ç”¨éƒ½åº”æ”¹ä¸º `panel`ã€‚
      * `editPanel(pageIndex, panelIndex)` -\> `editPanel(panelIndex)`:
          * `const panel = this.panels[panelIndex]`
          * `this.editingPanelIndex = panelIndex`
          * `(é‡è¦)` `this.editingPanel = { ...panel }` (å¤åˆ¶æ‰€æœ‰å­—æ®µï¼ŒåŒ…æ‹¬`storyboard_id`)ã€‚
      * `savePanel()` (ä¿å­˜å•ä¸ªé¢æ¿çš„å¼¹çª—):
          * **(é‡è¦)** è¿™æ˜¯ä½ è¯´çš„â€œå…è®¸ç”¨æˆ·ä¿®æ”¹â€çš„æ ¸å¿ƒã€‚
          * è°ƒç”¨æ–°çš„ `PUT` æ¥å£ï¼š
            ```javascript
            async savePanel() {
              const panelToSave = this.editingPanel;
              const panelId = panelToSave.storyboard_id;
              
              // (...å‰ç«¯éªŒè¯...)
              
              // ä» editingPanel ä¸­æå–éœ€è¦æ›´æ–°çš„å­—æ®µ
              const updates = {
                original_text_snippet: panelToSave.original_text_snippet,
                character_appearance: panelToSave.character_appearance,
                scene_and_lighting: panelToSave.scene_and_lighting,
                camera_and_composition: panelToSave.camera_and_composition,
                expression_and_action: panelToSave.expression_and_action,
                style_requirements: panelToSave.style_requirements
                // æ³¨æ„ï¼šè¿™é‡Œä¹Ÿåº”è¯¥å…è®¸ä¿®æ”¹ character_idï¼Œä½†è¿™éœ€è¦ä¸€ä¸ªä¸‹æ‹‰æ¡†
              };

              try {
                const response = await uni.request({
                  url: `http://localhost:8000/api/v1/storyboard/${panelId}`,
                  method: 'PUT',
                  data: updates
                });
                
                if (response.statusCode === 200 && response.data.ok) {
                  // æ›´æ–°æœ¬åœ°æ•°æ®
                  this.panels[this.editingPanelIndex] = { ...panelToSave };
                  uni.showToast({ title: 'ä¿å­˜æˆåŠŸ', icon: 'success' });
                  this.closeModal();
                } else {
                  throw new Error('ä¿å­˜å¤±è´¥');
                }
              } catch (e) {
                uni.showToast({ title: e.message || 'ä¿å­˜å¤±è´¥', icon: 'none' });
              }
            }
            ```
      * `saveStoryboardToDatabase()`: è¿™ä¸ªâ€œå…¨éƒ¨ä¿å­˜â€æŒ‰é’®çš„é€»è¾‘ç°åœ¨æ˜¯é”™çš„ã€‚ä½ å¯ä»¥**æš‚æ—¶ç¦ç”¨æˆ–åˆ é™¤**å®ƒï¼Œå› ä¸º `savePanel` å·²ç»å®ç°äº†ä¿å­˜ã€‚

**3. `frontend/pages/projects/list.vue`**

  * **èŒè´£**: æ˜¾ç¤ºé¡¹ç›®åˆ—è¡¨ã€‚
  * **ä¿®æ”¹**:
      * `editStoryboard(project)`: è¿™ä¸ªæ–¹æ³•ç›®å‰æ˜¯è·³è½¬åˆ° `layout-planner`ï¼Œä½†å®ƒæ²¡æœ‰ `text_id`ã€‚
      * **(å»ºè®®)** è¿™ä¸ªæŒ‰é’®ä¸åº”è¯¥å«â€œç¼–è¾‘åˆ†é•œâ€ï¼Œè€Œåº”è¯¥å«â€œ**æŸ¥çœ‹ç« èŠ‚**â€ã€‚ç‚¹å‡»ååº”è¯¥è·³è½¬åˆ°ä¸€ä¸ª*æ–°çš„*é¡µé¢ï¼ˆä¾‹å¦‚ `pages/projects/detail.vue`ï¼‰ï¼Œè¯¥é¡µé¢æ˜¾ç¤ºè¯¥é¡¹ç›®ï¼ˆ`project_id`ï¼‰ä¸‹çš„æ‰€æœ‰`source_texts`ï¼ˆç« èŠ‚åˆ—è¡¨ï¼‰ã€‚å½“ç”¨æˆ·ç‚¹å‡»*æŸä¸ªç« èŠ‚*æ—¶ï¼Œæ‰è·³è½¬åˆ° `layout-planner` å¹¶ä¼ å…¥`project_id`å’Œ`text_id`ã€‚
      * **(ä¸´æ—¶ä¿®å¤)** å¦‚æœä½ ä¸æƒ³åˆ›å»ºæ–°é¡µé¢ï¼Œé‚£ä¹ˆ `editStoryboard(project)` åº”è¯¥**è·³è½¬åˆ° `script-analyzer.vue`** å¹¶ä¼ å…¥ `project_id`ï¼Œè®©ç”¨æˆ· *å…ˆ* ä¸Šä¼ æˆ–é€‰æ‹©ç« èŠ‚æ–‡æœ¬ã€‚
        ```javascript
        editStoryboard(project) {
          // é”™è¯¯:
          // uni.navigateTo({
          //   url: `/pages/storyboard/layout-planner?project_id=${project.project_id}`
          // })
          
          // æ­£ç¡® (ä¸´æ—¶):
          uni.navigateTo({
            url: `/pages/storyboard/script-analyzer?project_id=${project.project_id}`
          })
        }
        ```