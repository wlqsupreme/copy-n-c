# ç”¨æˆ·è®¤è¯åŠŸèƒ½å®ç°

æœ¬é¡¹ç›®å·²æˆåŠŸå®ç°äº†å®Œæ•´çš„ç”¨æˆ·ç™»å½•æ³¨å†ŒåŠŸèƒ½ï¼ŒåŒ…æ‹¬å‰ç«¯å’Œåç«¯çš„å®Œæ•´å®ç°ã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### åç«¯æ¶æ„

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ auth.py              # è®¤è¯APIè·¯ç”±
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ auth_service.py      # è®¤è¯æœåŠ¡å±‚
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”œâ”€â”€ models.py           # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ crud.py             # æ•°æ®åº“æ“ä½œ
â”‚   â””â”€â”€ main.py                 # ä¸»åº”ç”¨å…¥å£
â”œâ”€â”€ requirements.txt            # ä¾èµ–åŒ…
â””â”€â”€ test_auth.py               # è®¤è¯åŠŸèƒ½æµ‹è¯•
```

### å‰ç«¯æ¶æ„

```
frontend/
â”œâ”€â”€ pages/auth/
â”‚   â”œâ”€â”€ login.vue              # ç™»å½•é¡µé¢
â”‚   â””â”€â”€ register.vue          # æ³¨å†Œé¡µé¢
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ auth.js               # è®¤è¯ç®¡ç†å™¨
â””â”€â”€ config/
    â””â”€â”€ index.js              # é…ç½®æ–‡ä»¶
```

## ğŸ”§ æŠ€æœ¯æ ˆ

### åç«¯æŠ€æœ¯
- **FastAPI**: Webæ¡†æ¶
- **JWT**: ç”¨æˆ·è®¤è¯ä»¤ç‰Œ
- **bcrypt**: å¯†ç åŠ å¯†
- **python-jose**: JWTå¤„ç†
- **passlib**: å¯†ç å“ˆå¸Œ

### å‰ç«¯æŠ€æœ¯
- **Vue.js**: å‰ç«¯æ¡†æ¶
- **uni-app**: è·¨å¹³å°å¼€å‘æ¡†æ¶
- **æœ¬åœ°å­˜å‚¨**: ä»¤ç‰Œå’Œç”¨æˆ·ä¿¡æ¯ç®¡ç†

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

### ç”¨æˆ·æ³¨å†Œ
- âœ… ç”¨æˆ·åå”¯ä¸€æ€§éªŒè¯
- âœ… é‚®ç®±å”¯ä¸€æ€§éªŒè¯
- âœ… å¯†ç å¼ºåº¦éªŒè¯
- âœ… è‡ªåŠ¨ç”ŸæˆJWTä»¤ç‰Œ
- âœ… ç”¨æˆ·åè®®ç¡®è®¤

### ç”¨æˆ·ç™»å½•
- âœ… ç”¨æˆ·å/é‚®ç®±ç™»å½•
- âœ… å¯†ç éªŒè¯
- âœ… JWTä»¤ç‰Œç”Ÿæˆ
- âœ… è®°ä½æˆ‘åŠŸèƒ½
- âœ… è‡ªåŠ¨è·³è½¬

### å®‰å…¨ç‰¹æ€§
- âœ… å¯†ç bcryptåŠ å¯†
- âœ… JWTä»¤ç‰Œè®¤è¯
- âœ… ä»¤ç‰Œè‡ªåŠ¨åˆ·æ–°
- âœ… è®¤è¯çŠ¶æ€ç®¡ç†
- âœ… ç™»å‡ºåŠŸèƒ½

## ğŸ“¡ APIæ¥å£

### è®¤è¯æ¥å£

| æ¥å£ | æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|------|
| ç”¨æˆ·ç™»å½• | POST | `/api/v1/auth/login` | ç”¨æˆ·ç™»å½•éªŒè¯ |
| ç”¨æˆ·æ³¨å†Œ | POST | `/api/v1/auth/register` | æ–°ç”¨æˆ·æ³¨å†Œ |
| è·å–ç”¨æˆ·ä¿¡æ¯ | GET | `/api/v1/auth/me` | è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ |
| åˆ·æ–°ä»¤ç‰Œ | POST | `/api/v1/auth/refresh` | åˆ·æ–°è®¿é—®ä»¤ç‰Œ |
| ç”¨æˆ·ç™»å‡º | POST | `/api/v1/auth/logout` | ç”¨æˆ·ç™»å‡º |
| å¥åº·æ£€æŸ¥ | GET | `/api/v1/auth/health` | è®¤è¯æœåŠ¡çŠ¶æ€ |

### è¯·æ±‚ç¤ºä¾‹

#### ç™»å½•è¯·æ±‚
```json
{
  "username": "testuser",
  "password": "password123"
}
```

#### æ³¨å†Œè¯·æ±‚
```json
{
  "username": "newuser",
  "email": "user@example.com",
  "password": "password123"
}
```

### å“åº”ç¤ºä¾‹

#### æˆåŠŸå“åº”
```json
{
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
  "token_type": "bearer",
  "expires_in": 1800,
  "user": {
    "user_id": "uuid-string",
    "username": "testuser",
    "email": "user@example.com",
    "credit_balance": 0
  }
}
```

## ğŸ› ï¸ å®‰è£…å’Œè¿è¡Œ

### åç«¯å®‰è£…

1. å®‰è£…ä¾èµ–åŒ…ï¼š
```bash
cd backend
pip install -r requirements.txt
```

2. é…ç½®ç¯å¢ƒå˜é‡ï¼š
```bash
# è®¾ç½®JWTå¯†é’¥
export JWT_SECRET_KEY="your-secret-key-change-in-production"
```

3. è¿è¡ŒæœåŠ¡ï¼š
```bash
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### å‰ç«¯è¿è¡Œ

1. ä½¿ç”¨HBuilderXæ‰“å¼€frontendç›®å½•
2. è¿è¡Œåˆ°æµè§ˆå™¨æˆ–æ¨¡æ‹Ÿå™¨
3. è®¿é—®ç™»å½•/æ³¨å†Œé¡µé¢æµ‹è¯•åŠŸèƒ½

## ğŸ§ª æµ‹è¯•

### è¿è¡Œè®¤è¯åŠŸèƒ½æµ‹è¯•
```bash
cd backend
python test_auth.py
```

### æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤

1. **æ³¨å†Œæµ‹è¯•**ï¼š
   - è®¿é—®æ³¨å†Œé¡µé¢
   - è¾“å…¥ç”¨æˆ·åã€é‚®ç®±ã€å¯†ç 
   - ç¡®è®¤ç”¨æˆ·åè®®
   - ç‚¹å‡»æ³¨å†ŒæŒ‰é’®

2. **ç™»å½•æµ‹è¯•**ï¼š
   - è®¿é—®ç™»å½•é¡µé¢
   - è¾“å…¥ç”¨æˆ·å/é‚®ç®±å’Œå¯†ç 
   - ç‚¹å‡»ç™»å½•æŒ‰é’®

3. **APIæµ‹è¯•**ï¼š
   - ä½¿ç”¨Postmanæˆ–curlæµ‹è¯•APIæ¥å£
   - éªŒè¯ä»¤ç‰Œæœ‰æ•ˆæ€§
   - æµ‹è¯•å—ä¿æŠ¤çš„æ¥å£

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

1. **ç”Ÿäº§ç¯å¢ƒé…ç½®**ï¼š
   - ä¿®æ”¹JWT_SECRET_KEYä¸ºå¼ºå¯†é’¥
   - ä½¿ç”¨HTTPSåè®®
   - é…ç½®CORSå…è®¸çš„åŸŸå

2. **å¯†ç å®‰å…¨**ï¼š
   - å¯†ç ä½¿ç”¨bcryptåŠ å¯†å­˜å‚¨
   - å‰ç«¯ä¸å­˜å‚¨æ˜æ–‡å¯†ç 
   - æ”¯æŒå¯†ç å¼ºåº¦éªŒè¯

3. **ä»¤ç‰Œå®‰å…¨**ï¼š
   - JWTä»¤ç‰Œæœ‰è¿‡æœŸæ—¶é—´
   - æ”¯æŒä»¤ç‰Œè‡ªåŠ¨åˆ·æ–°
   - ç™»å‡ºæ—¶æ¸…é™¤æœ¬åœ°å­˜å‚¨

## ğŸ“ ä½¿ç”¨è¯´æ˜

### å‰ç«¯ä½¿ç”¨

1. **å¯¼å…¥è®¤è¯ç®¡ç†å™¨**ï¼š
```javascript
import authManager from '../../utils/auth.js'
```

2. **ç”¨æˆ·ç™»å½•**ï¼š
```javascript
const result = await authManager.login(username, password)
if (result.success) {
  // ç™»å½•æˆåŠŸï¼Œç”¨æˆ·ä¿¡æ¯å·²è‡ªåŠ¨ä¿å­˜
}
```

3. **ç”¨æˆ·æ³¨å†Œ**ï¼š
```javascript
const result = await authManager.register(username, email, password)
if (result.success) {
  // æ³¨å†ŒæˆåŠŸï¼Œç”¨æˆ·ä¿¡æ¯å·²è‡ªåŠ¨ä¿å­˜
}
```

4. **æ£€æŸ¥ç™»å½•çŠ¶æ€**ï¼š
```javascript
if (authManager.isLoggedIn()) {
  // ç”¨æˆ·å·²ç™»å½•
}
```

5. **ç”¨æˆ·ç™»å‡º**ï¼š
```javascript
await authManager.logout()
```

### åç«¯ä½¿ç”¨

1. **ä¿æŠ¤APIæ¥å£**ï¼š
```python
from app.api.auth import get_current_user

@router.get("/protected")
async def protected_route(current_user: User = Depends(get_current_user)):
    return {"message": f"Hello {current_user.username}"}
```

2. **è·å–å½“å‰ç”¨æˆ·**ï¼š
```python
from app.services.auth_service import auth_service

user = await auth_service.get_current_user(token)
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ•°æ®åº“è¿æ¥å¤±è´¥**ï¼š
   - æ£€æŸ¥Supabaseé…ç½®
   - éªŒè¯æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²

2. **JWTä»¤ç‰Œæ— æ•ˆ**ï¼š
   - æ£€æŸ¥JWT_SECRET_KEYé…ç½®
   - éªŒè¯ä»¤ç‰Œæ˜¯å¦è¿‡æœŸ

3. **å‰ç«¯APIè°ƒç”¨å¤±è´¥**ï¼š
   - æ£€æŸ¥APIåŸºç¡€URLé…ç½®
   - éªŒè¯CORSè®¾ç½®

4. **å¯†ç éªŒè¯å¤±è´¥**ï¼š
   - æ£€æŸ¥å¯†ç åŠ å¯†ç®—æ³•
   - éªŒè¯å¯†ç å“ˆå¸Œå­˜å‚¨

## ğŸ”„ æ›´æ–°æ—¥å¿—

- **v1.0.0**: åˆå§‹å®ç°
  - ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½
  - ç”¨æˆ·ç™»å½•åŠŸèƒ½
  - JWTä»¤ç‰Œè®¤è¯
  - å‰ç«¯è®¤è¯ç®¡ç†å™¨
  - å®Œæ•´çš„APIæ¥å£

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤Issueæˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚


